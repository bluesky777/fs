(function(){"use strict";angular.module("feryzApp",["ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ui.router","ui.bootstrap","ui.select","pascalprecht.translate","angular-loading-bar","toastr","http-auth-interceptor","ui.grid","ui.grid.edit","ui.grid.resizeColumns","ui.grid.exporter","ui.grid.selection","FBAngular","ngMaterial","angular-svg-round-progress","camera","ngFileUpload"]).constant("App",function(){var a,b,c;return a="http://localhost/",location.hostname.match("lalvirtual")&&(a="http://lalvirtual.com/"),location.hostname.match("olimpiadaslibertad")&&(a="http://olimpiadaslibertad.com/"),c=a+"feryz_server/public/",b=a+"feryz/",{Server:c,views:"views/",images:c+"images/",perfilPath:c+"images/perfil/",imgSystemPath:c+"images/eventos/"}}()).constant("AUTH_EVENTS",{loginSuccess:"auth-login-success",loginFailed:"auth-login-failed",logoutSuccess:"auth-logout-success",sessionTimeout:"auth-session-timeout",notAuthenticated:"auth-not-authenticated",notAuthorized:"auth-not-authorized"}).constant("USER_ROLES",{all:"*",admin:"admin",vendedor:"vendedor",tecnico:"tecnico"}).constant("PERMISSIONS",{can_work_like_admin:"can_work_like_admin",can_work_like_vendedor:"can_work_like_vendedor",can_work_like_tecnico:"can_work_like_tecnico",can_edit_usuarios:"can_edit_usuarios"})}).call(this),function(){"use strict";angular.module("feryzApp").controller("MainCtrl",["$scope","$window","$interval",function(a,b,c){}]).controller("LandingCtrl",["$scope","$window","$interval",function(a,b,c){}])}.call(this),function(){"use strict";angular.module("feryzApp").controller("ApplicationController",["$scope","USER_ROLES","AuthService","toastr","$state","$rootScope","$http","$filter",function(a,b,c,d,e,f,g,h){return a.isAuthorized=c.isAuthorized,a.hasRoleOrPerm=c.hasRoleOrPerm,a.USER_ROLES=b,a.isLoginPage=!1,a.main={skin:21},a.navFull=!0,a.toggleNav=function(){return a.navFull=!a.navFull},a.tema="theme-zero",a.cambiarTema=function(b){return a.tema=b},a.floatingSidebar=0,a.toggleFloatingSidebar=function(){return a.floatingSidebar=a.floatingSidebar?!1:!0}}])}.call(this),function(){angular.module("feryzApp").config(["$cookiesProvider","$stateProvider","$urlRouterProvider","$httpProvider","$locationProvider","App","PERMISSIONS","$intervalProvider","$rootScopeProvider","USER_ROLES","toastrConfig","uiSelectConfig",function(a,b,c,d,e,f,g,h,i,j,k,l){return d.defaults.useXDomain=!0,delete d.defaults.headers.common["X-Requested-With"],d.defaults.headers.common.Accept="application/json",d.defaults.headers.common["Content-Type"]="application/json",d.interceptors.push(["$q",function(a){return{request:function(a){var b;return b=a.url.split("::"),b.length>1?a.url=f.Server+b[1]:(b=a.url.split("=="),b.length>1&&(a.url=f.views+b[1])),a}}}]),l.theme="select2",l.resetSearchInput=!0,c.otherwise("/login"),b.state("main",{url:"/",views:{principal:{templateUrl:f.views+"main/main.tpl.html",controller:"MainCtrl"}},data:{pageTitle:"En Construcción"}}).state("landing",{url:"/landing",views:{principal:{templateUrl:f.views+"main/landing.tpl.html",controller:"LandingCtrl"}},data:{pageTitle:"Liceo Adventista Libertad"}}).state("login",{url:"/login",views:{principal:{templateUrl:f.views+"login/login.tpl.html",controller:"LoginCtrl"}},data:{pageTitle:"Ingresar a Wissen"}}).state("logout",{url:"/logout",views:{principal:{templateUrl:f.views+"login/logout.tpl.html",controller:"LogoutCtrl"}},data:{icon_fa:"fa fa-user"}}),i.bigLoader=!0,_.mixin({findByValues:function(a,b,c){var d;return d=_.filter(a,function(a){return _.contains(c,a[b])}),0===d.length?!1:d[0]}}),angular.extend(k,{allowHtml:!0,closeButton:!0,extendedTimeOut:1e3,preventOpenDuplicates:!1,maxOpened:3,tapToDismiss:!0,target:"body",timeOut:4e3}),this}]).filter("capitalize",function(){return function(a,b){return a?a.replace(/([^\W_]+[^\s-]*) */g,function(a){return a.charAt(0).toUpperCase()+a.substr(1).toLowerCase()}):""}})}.call(this),function(){angular.module("feryzApp").run(["$rootScope","cfpLoadingBar","$state","$stateParams","$translate","$cookies","Perfil","AuthService","AUTH_EVENTS","toastr",function(a,b,c,d,e,f,g,h,i,j){var k;return a.examen_actual=[],a.$state=c,a.$stateParams=d,a.lastState=null,a.lastStateParam=null,a.$on("event:auth-loginRequired",function(a){return console.log("Acceso no permitido, vamos a loguear",a),c.transitionTo("login")}),k=function(){return null===a.lastState||"login"===a.lastState||"/"===a.lastState||"main"===a.lastState?c.go("panel"):c.go(a.lastState,a.lastStateParam)},a.$on("event:auth-loginConfirmed",function(){return console.log("Logueado con éxito!"),k()}),a.$on("$stateChangeStart",function(b,c,d,e,f){return null===a.lastState||"logout"!==c.name&&"login"!==c.name&&"main"!==c.name?(a.lastState=c.name,a.lastStateParam=d):void 0}),a.$on("$stateChangeSuccess",function(b,d,e,f,g){return a.pageTitle=c.current.name}),a.$on("$stateChangeError",function(b,d,e,f,g){return console.log(a.lastState,"-Evento fallido: ",b),j.warning("Lo sentimos, hubo un error o no puedes acceder a esta vista"),"panel"!==a.lastState?c.transitionTo("panel"):c.transitionTo("login")}),a.$on("$translatePartialLoaderStructureChanged",function(){return e.refresh(),console.log("Translate refrescado supuestamente.")}),a.$on(i.loginSuccess,function(){return k()}),a.$on(i.loginFailed,function(a){}),a.$on(i.notAuthenticated,function(a){return j.warning("No está autorizado.","Acceso exclusivo"),console.log("Evento notAuthenticated: ",a),c.transitionTo("login")}),a.$on(i.notAuthorized,function(b){return j.warning("No está autorizado para entrar a esta vista","Restringido"),c.go("panel"),console.log("Evento notAuthorized: ",b,a.lastState)})}])}.call(this),function(){"use strict";angular.module("feryzApp").config(["$stateProvider","App","USER_ROLES","PERMISSIONS","$translateProvider",function(a,b,c,d,e){return e.translations("EN",{LOGIN_MSG:"Sign In to the panel"}).translations("ES",{LOGIN_MSG:"Ingresa al panel"})}])}.call(this),function(){"use strict";angular.module("feryzApp").controller("LoginCtrl",["$scope","$rootScope","AUTH_EVENTS","AuthService","$location","$cookies","Perfil","App","$state","cfpLoadingBar",function(a,b,c,d,e,f,g,h,i,j){a.logoPath="images/MyVc-1.gif",a.credentials={username:"",password:""},j.complete(),a.login=function(){var b;return b=d.login_credentials(a.credentials),b.then(function(a){i.go("panel")},function(a){return console.log("Promise de login_credentials rechazada",a)})}}])}.call(this),function(){"use strict";angular.module("feryzApp").config(["$stateProvider","App","USER_ROLES","PERMISSIONS","$translateProvider",function(a,b,c,d,e){a.state("panel",{url:"/panel",views:{principal:{templateUrl:b.views+"panel/panel.tpl.html",controller:"PanelCtrl"}},resolve:{resolved_user:["AuthService",function(a){return a.verificar()}]},data:{pageTitle:"Feryz - Bienvenido"}}),e.preferredLanguage("ES"),e.translations("EN",{INICIO_MENU:"Home",USERS_MENU:"Users",EVENTS_MENU:"Events",ENTIDADES_MENU:"Entities",CATEGS_MENU:"Categories",PREGUNTAS_MENU:"Questions",EVALUACIONES_MENU:"Tests",IDIOMA_MENU:"Language",INFORMES_MENU:"Reports",SALIR:"Sign out",ELIMINATORIAS:"Playoffs",GRAN_FINAL:"Great ultimate",INSCRITO_EN:"You are signed in:",NO_ESTAS_INSCRITO:"You are`t signed in any category.",EXAM_HECHOS:"Done Exams"}).translations("ES",{INICIO_MENU:"Inicio",EVENTS_MENU:"Eventos",ENTIDADES_MENU:"Entidades",CATEGS_MENU:"Categorías",PREGUNTAS_MENU:"Preguntas",EVALUACIONES_MENU:"Evaluaciones",USERS_MENU:"Usuarios",IDIOMA_MENU:"Idioma",INFORMES_MENU:"Informes",SALIR:"Salir",ELIMINATORIAS:"Eliminatorias",GRAN_FINAL:"Gran final",INSCRITO_EN:"Estás inscrito en:",NO_ESTAS_INSCRITO:"No estás inscrito en ninguna categoría.",EXAM_HECHOS:"Exámenes hechos"}).translations("PT",{INICIO_MENU:"Iniciação",EVENTS_MENU:"Eventos",ENTIDADES_MENU:"Entidades",CATEGS_MENU:"Categorias",PREGUNTAS_MENU:"Interrogatório",EVALUACIONES_MENU:"Evaluations",USERS_MENU:"Usuários",IDIOMA_MENU:"Língua",INFORMES_MENU:"Informação",SALIR:"Deixar",ELIMINATORIAS:"Playoffs",GRAN_FINAL:"Grande final",INSCRITO_EN:"Você está matriculado:",NO_ESTAS_INSCRITO:"Você não está registrado em qualquer categoria.",EXAM_HECHOS:"Testes feitos"}).translations("FR",{INICIO_MENU:"Initiation",EVENTS_MENU:"Événements",ENTIDADES_MENU:"Entités",CATEGS_MENU:"Catégories",PREGUNTAS_MENU:"Questionnement",EVALUACIONES_MENU:"Evaluations",USERS_MENU:"Utilisateurs",IDIOMA_MENU:"Langue",INFORMES_MENU:"Rapports",SALIR:"Laisser",ELIMINATORIAS:"Playoffs",GRAN_FINAL:"Grande finale",INSCRITO_EN:"Vous êtes inscrit à:",NO_ESTAS_INSCRITO:"Vous n'êtes pas inscrit dans aucune catégorie.",EXAM_HECHOS:"Tests effectués"})}])}.call(this),function(){"use strict";angular.module("feryzApp").controller("PanelCtrl",["$scope","$http","$state","$cookies","$rootScope","AuthService","Perfil","App","resolved_user","toastr","$translate","$filter","$uibModal",function(a,b,c,d,e,f,g,h,i,j,k,l,m){a.USER=i,a.imagesPath=h.images,f.verificar_acceso(),e.$on("$stateChangeSuccess",function(b,c,d,e,f){return a.cambiarTema("theme-zero")}),a.openMenu=function(a,b){var c;return c=b,a(b)},a.set_system_event=function(b){return Restangular.one("eventos/set-evento-actual").customPUT({id:b.id}).then(function(c){return console.log("Evento cambiado: ",c),angular.forEach(a.USER.eventos,function(a,b){return a.actual=!1}),b.actual=!0,j.success("Evento actual cambiado por "+b.alias)},function(a){return console.log("Error conectando!",a),j.warning("No se pudo cambiar el evento actual.")})},a.evento_actual={},a.el_evento_actual=function(){if(a.USER){if(!f.isAuthorized("can_work_like_admin"))return a.evento_actual=a.USER.evento_actual;try{return a.evento_actual=l("filter")(a.USER.eventos,{id:a.USER.evento_selected_id})[0]}catch(b){return a.evento_actual={}}finally{e.$broadcast("cambia_evento_actual")}}},a.el_evento_actual(),a.set_user_event=function(c){return b.put("eventos/set-user-event",{evento_id:c.id}).then(function(b){return console.log("Evento cambiado: ",b),a.USER.evento_selected_id=c.id,a.el_evento_actual(),j.success("Evento actual cambiado por "+c.alias),e.$broadcast("cambio_evento_user")},function(a){return console.log("Error conectando!",a),j.warning("No se pudo cambiar el evento actual.")})},a.logout=function(){return f.logout(),b.one("login/logout").customPUT().then(function(a){return console.log("Desconectado con éxito: ",a)},function(a){return console.log("Error desconectando!",a)})}}])}.call(this),function(){angular.module("feryzApp").config(["$stateProvider","App",function(a,b){return a.state("panel.usuarios",{url:"^/usuarios",views:{contenido_panel:{templateUrl:b.views+"usuarios/usuarios.tpl.html",controller:"UsuariosCtrl"}}})}])}.call(this),function(){angular.module("feryzApp").controller("UsuariosCtrl",["$scope","$http","App","$filter","toastr",function(a,b,c,d,e){var f,g;return a.creando=!1,a.editando=!1,a.usuarioActualizar={},a.tipos_doc=[{id:1,tipo:"Cédula"},{id:2,tipo:"Cédula extranjera"},{id:3,tipo:"Tarjeta de identidad"}],a.usuarioNuevo={sexo:"M",password:"",tipo_doc:{id:1,tipo:"Cédula"}},b.get("::usuarios/examenes").then(function(b){return a.examenes=b.data},function(){return e.error("No se pudo traer los exámenes.")}),b.get("::paises/all").then(function(b){return a.paises=b.data,a.usuarioNuevo.pais=d("filter")(a.paises,{id:1})[0],a.usuarioNuevo.pais_doc=d("filter")(a.paises,{id:1})[0],a.paisSeleccionado(a.usuarioNuevo.pais),a.paisdocSeleccionado(a.usuarioNuevo.pais_doc)},function(){return e.error("No se pudo traer las ciudades.")}),a.paisSeleccionado=function(c,d){return b.get("::ciudades/departamentos",{params:{pais_id:c.id}}).then(function(b){return a.departamentos=b.data},function(){return e.error("No se pudo traer las ciudades.")})},a.paisdocSeleccionado=function(c,d){return b.get("::ciudades/departamentos",{params:{pais_id:c.id}}).then(function(b){return a.departamentos_doc=b.data},function(){return e.error("No se pudo traer las ciudades.")})},a.departamentoSeleccionado=function(c,d){return b.get("::ciudades/ciudades",{params:{departamento:c.departamento}}).then(function(b){return a.ciudades=b.data},function(){return e.error("No se pudo traer las ciudades.")})},a.departamentoDocSeleccionado=function(c,d){return b.get("::ciudades/ciudades",{params:{departamento:c.departamento}}).then(function(b){return a.ciudades_doc=b.data},function(){return e.error("No se pudo traer las ciudades.")})},a.crearUsuario=function(){return a.creando=!0,a.editando=!1},a.guardarUsuario=function(){return a.usuarioNuevo.password!==a.usuarioNuevo.password_confirm?(e.warning("La contraseña y confirmación no coinciden"),!1):a.usuarioNuevo.password.length<3?(e.warning("La contraseña debe tener al menos 3 caracteres"),!1):b.post("::usuarios/guardar",a.usuarioNuevo).then(function(b){return a.opcionesGrid.data.push(b.data),e.success("Creado correctamente: "+b.data.nombres),a.creando=!1},function(a){return e.error("No se pudo crear usuario","Error")})},a.eliminarUsuario=function(c){return b["delete"]("::usuarios/eliminar/"+c.id).then(function(b){return a.usuarios=d("filter")(a.usuarios,{id:"!"+c.id})},function(a){return console.log("No se pudo eliminar producto",a)})},a.actualizarUsuario=function(c){return b.put("::usuarios/actualizar",a.usuarioActualizar).then(function(b){return e.success("Actualizado correctamente: "+b.nombre),a.editando=!1},function(a){return e.error("No se pudo crear","Error"),console.log("No se pudo guardar Producto",a)})},a.editarUsuario=function(c){var e;return a.creando=!1,a.editando=!0,a.usuarioActualizar=c,e=d("filter")(a.tipos_doc,{tipo:a.usuarioActualizar.doc_tipo},!0),e=e.length>0?e[0]:a.tipos_doc[0],a.usuarioActualizar.tipo_doc=e,null===a.usuarioActualizar.ciudad_nac?(a.usuarioActualizar.pais={id:1,pais:"COLOMBIA",abrev:"CO"},a.paisSeleccionado(a.usuarioActualizar.pais,a.usuarioActualizar.pais)):b.get("::ciudades/datosciudad/"+a.usuarioActualizar.ciudad_nac).then(function(b){return a.paises=b.data.paises,a.departamentosNac=b.data.departamentos,a.ciudadesNac=b.data.ciudades,a.usuarioActualizar.pais=b.data.pais,a.usuarioActualizar.depart_nac=b.data.departamento,a.usuarioActualizar.ciudad_nac=b.data.ciudad}),null===a.usuarioActualizar.ciudad_doc?(a.usuarioActualizar.pais_doc={id:1,pais:"COLOMBIA",abrev:"CO"},a.paisSeleccionado(a.usuarioActualizar.pais_doc,a.usuarioActualizar.pais_doc)):b.get("::ciudades/datosciudad/"+a.usuarioActualizar.ciudad_doc).then(function(b){return a.paises=b.data.paises,a.departamentosNac=b.data.departamentos,a.ciudadesNac=b.data.ciudades,a.usuarioActualizar.pais_doc=b.data.pais,a.usuarioActualizar.depart_doc=b.data.departamento,a.usuarioActualizar.ciudad_doc=b.data.ciudad})},a.traerUsuarios=function(){return b.get("::usuarios/all").then(function(b){return a.opcionesGrid.data=b.data},function(a){return console.log("No se pudo traer los usuarios",a)})},a.traerUsuarios(),f='<a class="btn btn-default btn-xs" ng-click="grid.appScope.editarUsuario(row.entity)"><md-tooltip md-direction="left">Editar</md-tooltip><i class="fa fa-edit "></i></a>',g='<a class="btn btn-default btn-xs" ng-click="grid.appScope.eliminarUsuario(row.entity)"><md-tooltip md-direction="left">Eliminar</md-tooltip><i class="fa fa-times "></i></a>',a.opcionesGrid={showGridFooter:!0,enableSorting:!0,columnDefs:[{field:"id",width:60,enableCellEdit:!1},{field:"Edit",cellTemplate:f+g,width:70,enableCellEdit:!1},{field:"nombres",minWidth:100},{field:"apellidos",minWidth:100},{field:"sexo",width:50},{field:"username",displayName:"Usuario"},{field:"email"},{field:"fecha_nac",type:"date",format:"yyyy-mm-dd"}],onRegisterApi:function(c){return a.gridApi=c,c.edit.on.afterCellEdit(a,function(c,d,f,g){return f!==g&&("sexo"===d.field?"M"===f||"F"===f?b.put("::usuarios/actualizar/"+c.id,c).then(function(a){return e.success("Usuario actualizado con éxito","Actualizado")},function(a){return e.error("Cambio no guardado","Error"),console.log("Falló al intentar guardar: ",a)}):(a.toastr.warning("Debe usar M o F"),c.sexo=g):b.put("::usuarios/actualizar/"+c.id,c).then(function(a){return e.success("Usuario actualizado con éxito","Actualizado")},function(a){return e.error("Cambio no guardado","Error"),console.log("Falló al intentar guardar: ",a)})),a.$apply()})}}}])}.call(this),function(){angular.module("feryzApp").config(["$stateProvider","App",function(a,b){return a.state("empleados",{url:"/empleados",views:{principal:{templateUrl:b.views+"empleados/empleados.tpl.html",controller:"EmpleadosCtrl"}}})}])}.call(this),function(){angular.module("feryzApp").controller("EmpleadosCtrl",["$scope","$http","$filter","toastr",function(a,b,c,d){return a.creando=!1,a.empleadoNuevo={},a.editando=!1,a.empleadoEdit={},a.empleados=[],a.crearEmpleado=function(){return a.creando=!0},a.guardarEmpleado=function(){return b.one("empleados/guardar").customPOST(a.empleadoNuevo).then(function(b){return a.empleados.push(b),d.success("Creado correctamente: "+b.nombre),a.creando=!1},function(a){return d.error("No se pudo crear","Error"),console.log("No se pudo guardar Empleado",a)})},a.eliminarEmpleado=function(d){return b.one("empleados/eliminar").customDELETE(d.id).then(function(b){return a.empleados=c("filter")(a.empleados,{id:"!"+d.id})},function(a){return console.log("No se pudo eliminar empleado",a)})},a.actualizarEmpleado=function(c){return b.one("empleados/actualizar").customPUT(a.empleadoEdit).then(function(b){return d.success("Actualizado correctamente: "+b.nombre),a.editando=!1},function(a){return d.error("No se pudo crear","Error"),console.log("No se pudo guardar Empleado",a)})},a.editarEmpleado=function(b){return a.editando=!0,a.empleadoEdit=prod},a.traerEmpleados=function(){return b.one("empleados").customGET("all").then(function(b){return a.empleados=b},function(a){return console.log("No se pudo traer los empleados",a)})},a.traerEmpleados()}])}.call(this),function(){angular.module("feryzApp").config(["$stateProvider","App",function(a,b){return a.state("productos",{url:"/productos",views:{principal:{templateUrl:b.views+"productos/productos.tpl.html",controller:"ProductosCtrl"}}})}])}.call(this),function(){angular.module("feryzApp").controller("ProductosCtrl",["$scope","$http","$filter","toastr",function(a,b,c,d){return a.creando=!1,a.productoNuevo={},a.editando=!1,a.productoEdit={},a.productos=[],a.crearProducto=function(){return a.creando=!0},a.guardarProducto=function(){return b.get("productos/guardar").customPOST(a.productoNuevo).then(function(b){return a.productos.push(b),d.success("Creado correctamente: "+b.nombre),a.creando=!1},function(a){return d.error("No se pudo crear","Error"),console.log("No se pudo guardar Producto",a)})},a.eliminarProducto=function(d){return b.get("productos/destroy").customDELETE(d.id).then(function(b){return a.productos=c("filter")(a.productos,{id:"!"+d.id})},function(a){return console.log("No se pudo eliminar producto",a)})},a.actualizarProducto=function(c){return b.get("productos/actualizar").customPUT(a.productoEdit).then(function(b){return d.success("Actualizado correctamente: "+b.nombre),a.editando=!1},function(a){return d.error("No se pudo crear","Error"),console.log("No se pudo guardar Producto",a)})},a.editarProducto=function(b){return a.editando=!0,a.productoEdit=b},a.traerProductos=function(){return b.get("productos").customGET("all").then(function(b){return a.productos=b},function(a){return console.log("No se pudo traer productos",a)})},a.traerProductos()}])}.call(this),function(){angular.module("feryzApp").config(["$stateProvider","App",function(a,b){return a.state("panel.pacientes",{url:"^/pacientes",views:{contenido_panel:{templateUrl:"==pacientes/pacientes.tpl.html",controller:"PacientesCtrl"}}})}])}.call(this),function(){angular.module("feryzApp").controller("PacientesCtrl",["$scope","$http","App","$filter","toastr",function(a,b,c,d,e){var f,g,h,i,j,k;for(a.pacienteEdit={},a.pacienteNuevo={sexo:"M",estereopsis:"N",test_color:"N",sintomas_vision:[]},a.creando=!1,a.editando=!1,a.crearPaciente=function(){return a.creando=!0},a.opt_sintomas_vision=[{nombre:"Ver borroso"},{nombre:"Tiene ojos grandes"},{nombre:"Me asusta"},{nombre:"Visión de medusa"}],j=a.opt_sintomas_vision,h=0,i=j.length;i>h;h++)k=j[h],k._lowername=k.nombre.toLowerCase();return a.dateOptions={formatYear:"yy"},a.tipos_doc=[{id:1,tipo:"Cédula"},{id:2,tipo:"Cédula extranjera"},{id:3,tipo:"Tarjeta de identidad"}],a.ctrl={},a.transformChip=function(a){return angular.isObject(a)?a:{nombre:a,type:"new"}},a.ctrl.querySearch=function(b){var c;return c=b?a.opt_sintomas_vision.filter(a.createFilterFor(b)):[]},a.createFilterFor=function(a){var b;return b=angular.lowercase(a),function(a){return-1!==a._lowername.indexOf(b)}},b.get("::paises/all").then(function(b){return a.paises=b.data,a.pacienteNuevo.pais=d("filter")(a.paises,{id:1})[0],a.paisSeleccionado(a.pacienteNuevo.pais)},function(){return e.error("No se pudo traer las ciudades.")}),a.paisSeleccionado=function(c,d){return b.get("::ciudades/departamentos",{params:{pais_id:c.id}}).then(function(b){return a.departamentos=b.data},function(){return e.error("No se pudo traer las ciudades.")})},a.departamentoSeleccionado=function(c,d){return b.get("::ciudades/ciudades",{params:{departamento:c.departamento}}).then(function(b){return a.ciudades=b.data},function(){return e.error("No se pudo traer las ciudades.")})},a.eliminarPaciente=function(c){return b["delete"]("::pacientes/eliminar/"+c.id).then(function(b){return a.pacientes=d("filter")(a.pacientes,{id:"!"+c.id})},function(a){return console.log("No se pudo eliminar pacientes",a)})},a.editarPaciente=function(c){var e;return a.editando=!0,a.pacienteEdit=c,e=d("filter")(a.tipos_doc,{tipo:a.pacienteEdit.doc_tipo},!0),e=e.length>0?e[0]:a.tipos_doc[0],a.pacienteEdit.doc_tipo=e,null===a.pacienteEdit.ciudad_nac_id?(a.pacienteEdit.pais={id:1,pais:"COLOMBIA",abrev:"CO"},a.paisSeleccionado(a.pacienteEdit.pais,a.pacienteEdit.pais)):b.get("::ciudades/datosciudad/"+a.pacienteEdit.ciudad_nac_id).then(function(b){return a.paises=b.data.paises,a.departamentosNac=b.data.departamentos,a.ciudadesNac=b.data.ciudades,a.pacienteEdit.pais=b.data.pais,a.pacienteEdit.depart_nac=b.data.departamento,a.pacienteEdit.ciudad_nac=b.data.ciudad}),b.put("::antecedentes-laborales/paciente",{paciente_id:c.id}).then(function(b){return a.pacienteEdit.antecedentesLaborales=b.data},function(a){return console.log("No se pudo traer los antecedentes",a)}),b.put("::accidentes-trabajo/paciente",{paciente_id:c.id}).then(function(b){return a.pacienteEdit.accidentesTrabajo=b.data},function(a){return console.log("No se pudo traer los accidentes",a)}),b.put("::enfermedades-profesionales/paciente",{paciente_id:c.id}).then(function(b){return a.pacienteEdit.enfermedadesProfesionales=b.data},function(a){return console.log("No se pudo traer los accidentes",a)})},a.traerPacientes=function(){return b.get("::pacientes/all").then(function(b){return a.opcionesGrid.data=b.data},function(a){return console.log("No se pudo traer los usuarios",a)})},a.traerPacientes(),f='<a class="btn btn-default btn-xs" ng-click="grid.appScope.editarPaciente(row.entity)"><md-tooltip md-direction="left">Editar</md-tooltip><i class="fa fa-edit "></i></a>',g='<a class="btn btn-default btn-xs" ng-click="grid.appScope.eliminarPaciente(row.entity)"><md-tooltip md-direction="left">Eliminar</md-tooltip><i class="fa fa-times "></i></a>',a.opcionesGrid={showGridFooter:!0,enableSorting:!0,columnDefs:[{field:"id",width:60,enableCellEdit:!1},{field:"Edit",cellTemplate:f+g,width:70,enableCellEdit:!1},{field:"nombres",minWidth:100},{field:"apellidos",minWidth:100},{field:"sexo",width:50},{field:"username",displayName:"Usuario"},{field:"email"},{field:"fecha_nac",type:"date",format:"yyyy-mm-dd"}],onRegisterApi:function(c){return a.gridApi=c,c.edit.on.afterCellEdit(a,function(c,d,f,g){return f!==g&&("sexo"===d.field?"M"===f||"F"===f?b.put("::pacientes/actualizar/"+c.id,c).then(function(a){return e.success("Paciente actualizado con éxito","Actualizado")},function(a){return e.error("Cambio no guardado","Error"),console.log("Falló al intentar guardar: ",a)}):(a.toastr.warning("Debe usar M o F"),c.sexo=g):b.put("::pacientes/actualizar/"+c.id,c).then(function(a){return e.success("Paciente actualizado con éxito","Actualizado")},function(a){return e.error("Cambio no guardado","Error"),console.log("Falló al intentar guardar: ",a)})),a.$apply()})}}}])}.call(this),function(){angular.module("feryzApp").directive("pacienteEditarDir",["toastr","$http",function(a,b){return{restrict:"AE",transclude:!0,templateUrl:"==pacientes/pacienteEditarDir.tpl.html",controller:"PacienteEditarCtrl"}}]).controller("PacienteEditarCtrl",["$scope","$http","App","$filter","toastr",function(a,b,c,d,e){return a.actualizarPaciente=function(){return b.put("::pacientes/actualizar",a.pacienteEdit).then(function(b){return e.success("Actualizado correctamente: "+b.nombre),a.editando=!1},function(a){return e.error("No se pudo crear","Error"),console.log("No se pudo guardar Paciente",a)})}}])}.call(this),function(){angular.module("feryzApp").directive("nuevoPacienteDir",["toastr","$http",function(a,b){return{restrict:"AE",transclude:!0,templateUrl:"==pacientes/nuevoPacienteDir.tpl.html",controller:"NuevoPacienteCtrl"}}]).controller("NuevoPacienteCtrl",["$scope","$http","App","$filter","toastr","Upload",function(a,b,c,d,e,f){return a.imagesPath=c.images,a.vm={},a.guardarPaciente=function(){return b.post("::pacientes/guardar",a.pacienteNuevo).then(function(b){return console.log("$scope.pacienteNuevo",a.pacienteNuevo),a.opcionesGrid.data.push(b.data),e.success("Creado correctamente: "+b.data.nombres),a.creando=!1,a.pacienteNuevo={sexo:"M",estereopsis:"N",test_color:"N",sintomas_vision:[]}},function(a){return e.error("No se pudo crear","Error"),console.log("No se pudo guardar paciente",a)})},a.upload=function(){var b;return b=a.vm.picture,console.log(b),b?f.upload({url:"::imagenes/store",fields:{Title:"test"},file:b,headers:{Accept:"application/json;odata=verbose","content-type":"image/jpeg","X-RequestDigest":$("#__REQUESTDIGEST").val()}}).progress(function(a){var b;return b=parseInt(100*a.loaded/a.total),console.log("progress: "+b+"% "+a.config.file.name)}).success(function(a,b,c,d){return console.log("file "+d.file.name+"uploaded. Response: "+a)}):void 0}}])}.call(this),function(){angular.module("feryzApp").directive("antecedentesLaboralesDir",["toastr","$http",function(a,b){return{restrict:"AE",transclude:!0,templateUrl:"==pacientes/antecedentesLaborales.tpl.html",controller:"AntecedentesLaboralesCtrl"}}]).controller("AntecedentesLaboralesCtrl",["$scope","$http","App","$filter","toastr",function(a,b,c,d,e){return a.creandoAntecLabor=!1,a.editandoAntecLabor=!1,a.AntecLaborNuevo={},a.AntecLaborActual={},a.editarAntecLabor=function(b){return a.editandoAntecLabor=!0,a.creandoAntecLabor=!1,a.AntecLaborActual=b},a.nuevoAntecLabor=function(b){return a.creandoAntecLabor=!0,a.editandoAntecLabor=!1,a.AntecLaborNuevo={}},a.guardarAntecedenteLaboral=function(){return a.AntecLaborNuevo.paciente_id=a.pacienteEdit.id,b.post("::antecedentes-laborales/guardar",a.AntecLaborNuevo).then(function(b){return a.pacienteEdit.antecedentesLaborales.push(b.data),a.creandoAntecLabor=!1,a.AntecLaborNuevo={},e.success("Antecedente agregado")},function(a){return e.error("No se pudo agregar antecedente")})},a.actualizarAntecLaboral=function(){return b.put("::antecedentes-laborales/actualizar",a.AntecLaborActual).then(function(b){return a.editandoAntecLabor=!1,e.success("Antecedente actualizado")},function(a){return e.error("No se pudo agregar antecedente")})}}])}.call(this),function(){angular.module("feryzApp").directive("accidentesTrabajoDir",["toastr","$http",function(a,b){return{restrict:"AE",transclude:!0,templateUrl:"==pacientes/accidentesTrabajoDir.tpl.html",controller:"AccidentesTrabajoCtrl"}}]).controller("AccidentesTrabajoCtrl",["$scope","$http","App","$filter","toastr",function(a,b,c,d,e){return a.creandoAccidTrabajo=!1,a.editandoAccidTrabajo=!1,a.AccidTrabajoNuevo={},a.AccidTrabajoActual={},a.editarAccidTrabajo=function(b){return a.editandoAccidTrabajo=!0,a.creandoAccidTrabajo=!1,a.AccidTrabajoActual=b},a.nuevoAccidTrabajo=function(b){return a.creandoAccidTrabajo=!0,a.editandoAccidTrabajo=!1,a.AccidTrabajoNuevo={}},a.guardarAccidenteTrabajo=function(){return a.AccidTrabajoNuevo.paciente_id=a.pacienteEdit.id,b.post("::accidentes-trabajo/guardar",a.AccidTrabajoNuevo).then(function(b){return a.pacienteEdit.accidentesTrabajo.push(b.data),a.creandoAccidTrabajo=!1,a.AccidTrabajoNuevo={},e.success("Antecedente agregado")},function(a){return e.error("No se pudo agregar antecedente")})},a.actualizarAccidTrabajo=function(){return b.put("::accidentes-trabajo/actualizar",a.AccidTrabajoActual).then(function(b){return a.editandoAccidTrabajo=!1,e.success("Antecedente actualizado")},function(a){return e.error("No se pudo agregar antecedente")})}}])}.call(this),function(){angular.module("feryzApp").directive("enfermedadesProfesionalesDir",["toastr","$http",function(a,b){return{restrict:"AE",transclude:!0,templateUrl:"==pacientes/enfermedadesProfesionalesDir.tpl.html",controller:"EnfermedadesProfesionalesCtrl"}}]).controller("EnfermedadesProfesionalesCtrl",["$scope","$http","App","$filter","toastr",function(a,b,c,d,e){return a.creandoEnferPro=!1,a.editandoEnferPro=!1,a.EnferProNuevo={},a.EnferProActual={},a.editarEnferPro=function(b){return a.editandoEnferPro=!0,a.creandoEnferPro=!1,a.EnferProActual=b},a.nuevoEnferPro=function(b){return a.creandoEnferPro=!0,a.editandoEnferPro=!1,a.EnferProNuevo={}},a.guardarEnfermedadProfesional=function(){return console.log(a.pacienteEdit.id),a.EnferProNuevo.paciente_id=a.pacienteEdit.id,b.post("::enfermedades-profesionales/guardar",a.EnferProNuevo).then(function(b){return a.pacienteEdit.enfermedadesProfesionales.push(b.data),a.creandoEnferPro=!1,a.EnferProNuevo={},e.success("Enfermedad agregada")},function(a){return e.error("No se pudo agregar Enfermedad")})},a.actualizarEnferPro=function(){return b.put("::enfermedades-profesionales/actualizar",a.EnferProActual).then(function(b){return a.editandoEnferPro=!1,e.success("Enfermedad actualizada")},function(a){return e.error("No se pudo actualizar Enfermedad")})}}])}.call(this),function(){"use strict";angular.module("feryzApp").config(["$stateProvider","App","USER_ROLES","PERMISSIONS","$translateProvider",function(a,b,c,d,e){a.state("panel.informes",{url:"^/informes/",views:{contenido_panel:{templateUrl:"==informes/informes.tpl.html",controller:"InformesCtrl"}},resolve:{resolved_user:["AuthService",function(a){return a.verificar()}],pacientes:["$http",function(a){return a.get("::pacientes/all")}]},data:{pageTitle:"Informes"}}).state("panel.informes.ver_usuarios",{url:"ver_usuarios",views:{report_content:{templateUrl:"==informes/verUsuarios.tpl.html",controller:"VerUsuariosCtrl",resolve:{usuarios:["$http","$stateParams",function(a,b){return a.get("::usuarios/all")}]}}},data:{pageTitle:"Usuarios - Feryz"}}).state("panel.informes.ver_pacientes",{url:"ver_pacientes",views:{report_content:{templateUrl:"==informes/verPacientes.tpl.html",controller:"VerPacientesCtrl",resolve:{pacientes:["$http","$stateParams",function(a,b){return a.get("::pacientes/resumen")}]}}},data:{pageTitle:"Pacientes - Feryz"}}).state("panel.informes.ver_exameningreso",{url:"ver_exameningreso",views:{report_content:{templateUrl:"==informes/verExamenIngreso.tpl.html",controller:"VerExamenIngresoCtrl",resolve:{exameningreso:["$http","$stateParams",function(a,b){return a.get("::pacientes/examen-ingreso")}]}}},data:{pageTitle:"Pacientes - Feryz"}})}])}.call(this),function(){"use strict";angular.module("feryzApp").controller("InformesCtrl",["$scope","$http","$state","$cookieStore","$rootScope","toastr","$filter","pacientes",function(a,b,c,d,e,f,g,h){return a.config={},a.pacientes=h.data,a.verUsuarios=function(){return c.go("panel.informes.ver_usuarios",{},{reload:!0})},a.verPacientes=function(){return c.go("panel.informes.ver_pacientes",{},{reload:!0})},a.verExamenIngreso=function(){return c.go("panel.informes.ver_exameningreso",{},{reload:!0})},a.$on("cambia_descripcion",function(b,c){
return a.descripcion_informe=c}),d.get("config")?(a.config=d.get("config"),a.informe_tab_pacientes="pacientes"===a.config.informe_tab_actual?!0:!1):a.config.orientacion="vertical",a.$watch("config",function(b,c){return d.put("config",b),a.$broadcast("change_config")},!0),a.tabSeleccionado=function(b){return a.config.informe_tab_actual=b,d.put("config",a.config)}}])}.call(this),function(){"use strict";angular.module("feryzApp").controller("VerUsuariosCtrl",["$scope","$http","$state","$cookies","$rootScope","toastr","$filter","usuarios",function(a,b,c,d,e,f,g,h){return a.usuarios=h.data}])}.call(this),function(){"use strict";angular.module("feryzApp").controller("VerPacientesCtrl",["$scope","$http","$state","$cookies","$rootScope","toastr","$filter","pacientes",function(a,b,c,d,e,f,g,h){return a.pacientes=h.data}])}.call(this),function(){"use strict";angular.module("feryzApp").controller("VerExamenIngresoCtrl",["$scope","$http","$state","$cookies","$rootScope","toastr","$filter","exameningreso",function(a,b,c,d,e,f,g,h){return a.exameningreso=h.data}])}.call(this),function(){angular.module("feryzApp").config(["$stateProvider","App",function(a,b){return a.state("panel.ciudades",{url:"^/ciudades",views:{contenido_panel:{templateUrl:"==ciudades/ciudades.tpl.html",controller:"CiudadesCtrl"}}})}])}.call(this),function(){angular.module("feryzApp").controller("CiudadesCtrl",["$scope","$http","App","$filter","toastr",function(a,b,c,d,e){return a.creandociudad=!1,a.creandodepartamento=!1,a.creandopais=!1,a.crearciudad={nuevo_depart:!1},a.modificando_depart=!1,a.crearpais={},a.hola=!1,b.get("::paises/all").then(function(b){return a.paises=b.data,a.crearciudad.pais=d("filter")(a.paises,{id:1})[0],a.paisSeleccionado(a.crearciudad.pais)},function(){return e.error("No se pudo traer las ciudades.")}),a.paisSeleccionado=function(c,f){return b.get("::ciudades/departamentos",{params:{pais_id:c.id}}).then(function(b){return a.departamentos=b.data,a.modificando_depart?(a.crearciudad.depart=d("filter")(a.departamentos,{departamento:f},!0)[0],a.departamentoSeleccionado(a.crearciudad.depart),a.modificando_depart=!1):void 0},function(){return e.error("No se pudo traer las ciudades.")})},a.departamentoSeleccionado=function(c,d){return b.get("::ciudades/ciudades",{params:{departamento:c.departamento}}).then(function(b){return a.ciudades=b.data},function(){return e.error("No se pudo traer las ciudades.")})},a.crearCiudad=function(){return a.creandociudad=!0},a.crearDepartamento=function(){return a.creandodepartamento=!0},a.crearPais=function(){return a.creandopais=!0},a.guardarCiudad=function(){return b.post("::ciudades/guardarciudad",a.crearciudad).then(function(c){return e.success("Creado correctamente: "+c.data.ciudad),a.ciudades.push(c.data),a.creandociudad=!1,a.crearciudad={},a.guardar=!0,b.get("::paises/all").then(function(a){},a.paises=c.data,a.crearciudad.pais=d("filter")(a.paises,{id:1})[0],a.paisSeleccionado(a.crearciudad.pais),function(a){return e.error("No se pudo traer las ciudades.")})},function(a){return e.error("No se pudo crear","Error")})},a.guardarPais=function(){return b.post("::paises/guardar",a.crearpais).then(function(b){return e.success("Creado correctamente: "+b.data.paisnuevo),a.paises.push(b.data),a.paisSeleccionado(a.crearciudad.pais)},function(a){return e.error("No se pudo crear","Error")})},a.actualizarCiudad=function(a){return b.put("::ciudades/actualizar-ciudad",a).then(function(b){return e.success("Actualizado: "+a.ciudad),a.editandoCiudad=!1},function(a){return e.error("No se pudo actualizar","Error")})},a.actualizarDepartamento=function(c){return b.put("::ciudades/actualizar-departamento",c).then(function(b){var d;return e.success("Actualizado: "+c.departamento),c.editandoDepart=!1,d=a.crearciudad.pais,a.modificando_depart=!0,a.paisSeleccionado(d,c.departamento)},function(a){return e.error("No se pudo actualizar","Error")})},a.actualizarPais=function(a){return b.put("::paises/actualizar",a).then(function(b){return e.success("Actualizado: "+a.pais),a.editandoPais=!1,a.editandoAbrev=!1},function(a){return e.error("No se pudo actualizar","Error")})},a.eliminarUsuario=function(c){return b["delete"]("::usuarios/eliminar/"+c.id).then(function(b){return a.usuarios=d("filter")(a.usuarios,{id:"!"+c.id})},function(a){return console.log("No se pudo eliminar producto",a)})},a.editarUsuario=function(c){var e;return a.editando=!0,a.usuarioActualizar=c,e=d("filter")(a.tipos_doc,{tipo:a.usuarioActualizar.doc_tipo},!0),e=e.length>0?e[0]:a.tipos_doc[0],a.usuarioActualizar.doc_tipo=e,null===a.usuarioActualizar.ciudad_nac?(a.usuarioActualizar.pais={id:1,pais:"COLOMBIA",abrev:"CO"},a.paisSeleccionado(a.usuarioActualizar.pais,a.usuarioActualizar.pais)):b.get("::ciudades/datosciudad/"+a.usuarioActualizar.ciudad_nac).then(function(b){return a.paises=b.data.paises,a.departamentosNac=b.departamentos,a.ciudadesNac=b.ciudades,a.usuarioActualizar.pais=b.pais,a.usuarioActualizar.depart_nac=b.departamento,a.usuarioActualizar.ciudad_nac=b.ciudad})}}])}.call(this),function(){angular.module("feryzApp").config(["$stateProvider","App",function(a,b){return a.state("panel.configuraciones",{url:"^/configuraciones",views:{contenido_panel:{templateUrl:"==configuraciones/configuraciones.tpl.html",controller:"ConfiguracionesCtrl"}}})}])}.call(this),function(){angular.module("feryzApp").controller("ConfiguracionesCtrl",["$scope","$http","App","$filter","toastr",function(a,b,c,d,e){return a.configuracion={},a.paisSeleccionado=function(c,f){return b.get("::ciudades/departamentos",{params:{pais_id:c.id}}).then(function(b){return a.departamentos=b.data,a.configuracion.departamento?(a.configuracion.depart=d("filter")(a.departamentos,{departamento:a.configuracion.departamento},!0)[0],a.departamentoSeleccionado(a.configuracion.depart)):void 0},function(){return e.error("No se pudo traer los departamentos.")})},a.departamentoSeleccionado=function(c,f){return b.get("::ciudades/ciudades",{params:{departamento:c.departamento}}).then(function(b){return a.ciudades=b.data,a.configuracion.ciudad_id?a.configuracion.ciudad_id=d("filter")(a.ciudades,{id:a.configuracion.ciudad_id},!0)[0]:void 0},function(){return e.error("No se pudo traer las ciudades.")})},a.guardar=function(c){return b.put("::configuracion/actualizar",a.configuracion).then(function(b){return e.success(a.configuracion.nombre_ips+' "Actualizada correctamente"')},function(a){return e.error("No se pudo Actualizar","Error"),console.log("No se pudo actualizar configuracion",a)})},a.traerConfiguracion=function(){return b.get("::configuracion/all").then(function(c){return a.configuracion=c.data[0],b.get("::paises/all").then(function(b){return a.paises=b.data,a.configuracion.pais=d("filter")(a.paises,{id:a.configuracion.pais_id},!0)[0],a.paisSeleccionado(a.configuracion.pais)},function(){return e.error("No se pudo traer las ciudades.")})},function(a){return console.log("No se pudo traer la configuracion",a)})},a.traerConfiguracion()}])}.call(this),function(){"use strict";angular.module("feryzApp").config(["$stateProvider",function(a){return a.state("panel.filemanager",{url:"/filemanager",views:{contenido_panel:{templateUrl:"==fileManager/fileManager.tpl.html",controller:"FileManagerCtrl"}},data:{pageTitle:"Administrador de archivos"}})}])}.call(this),function(){"use strict";angular.module("feryzApp").controller("FileManagerCtrl",["$scope","Upload","$timeout","$filter","App","$http","Perfil","$uibModal","resolved_user","toastr","AuthService",function(a,b,c,d,e,f,g,h,i,j,k){var l,m,n;a.USER=i,a.subir_intacta={},a.hasRoleOrPerm=k.hasRoleOrPerm,l=function(){return a.dato={imgUsuario:{id:a.USER.imagen_id,nombre:a.USER.imagen_nombre},imgOficial:{id:a.USER.foto_id,nombre:a.USER.foto_nombre}}},l(),a.perfilPath=e.images+"perfil/",a.imgFiles=[],a.errorMsg="",a.fileReaderSupported=null!==window.FileReader&&(null===window.FileAPI||FileAPI.html5!==!1),a.dato.usuarioElegido=[],f.get("::myimages").then(function(b){return b=b.data,a.imagenes_privadas=b.imagenes_privadas,a.imagenes_publicas=b.imagenes_publicas,a.dato.imgParaUsuario=b.imagenes_privadas[0]},function(a){return j.error("No se trajeron las imágenes.")}),a.upload=function(b){var c,d,e,f,g;if(a.imgFiles=b,a.errorMsg="",b&&b.length){for(g=[],d=e=0,f=b.length;f>=0?f>e:e>f;d=f>=0?++e:--e)c=b[d],g.push(m(c));return g}},m=function(b){return a.errorMsg=null,n(b),a.generateThumb(b)},a.generateThumb=function(b){return null!==b&&a.fileReaderSupported&&b.type.indexOf("image")>-1?c(function(){var a;return a=new FileReader,a.readAsDataURL(b),a.onload=function(a){return c(function(){return b.dataUrl=a.target.result})}}):void 0},n=function(c){var d;return d=a.subir_intacta.intacta?"-intacta":"",c.size>1e7?void(a.errorMsg="Archivo excede los 10MB permitidos."):b.upload({url:e.Server+"myimages/store"+d,file:c}).progress(function(a){var b;return b=parseInt(100*a.loaded/a.total),c.porcentaje=b}).success(function(b,c,d,e){return a.subir_intacta.intacta?a.imagenes_publicas.push(b):a.imagenes_privadas.push(b)}).error(function(a){return console.log("Falla uploading: ",a)}).xhr(function(a){})},a.pedirCambioUsuario=function(b){return f.put("::myimages/cambiarimagenperfil/"+a.USER.user_id,{imagen_id:b.id}).then(function(c){return c=c.data,g.setImagen(c.imagen_id,b.nombre),a.$emit("cambianImgs",{image:c}),j.success("Imagen principal cambiada")},function(a){return j.error("No se pudo cambiar imagen","Problema")})},a.pedirCambioOficial=function(b){return f.put("::myimages/cambiarimagenoficial/"+a.USER.user_id,{foto_id:b.id}).then(function(c){return c=c.data,c.asked_by_user_id?j.info("Pedido realizado, espera respuesta."):"En espera"===c?j.info("Espera respuesta."):(g.setOficial(c.foto_id,b.nombre),a.$emit("cambianImgs",{foto:c}),j.success("Foto oficial cambiada"))},function(a){return j.error("No se pudo cambiar foto","Problema")})},a.cambiarLogoColegio=function(a){return f.put("::myimages/cambiarlogocolegio",{logo_id:a.id}).then(function(a){return j.success("Logo del colegio cambiado")},function(a){return j.error("No se pudo cambiar el logo","Problema")})},a.imagenSelect=function(a,b){},a.fotoSelect=function(a,b){},a.grupoSelect=function(b,c){return f.get("::grupos/listado/"+b.id).then(function(b){return b=b.data,a.alumnos=b,a.dato.alumnoElegido=b[0]},function(a){return j.error("No se pudo traer los usuarios")})},a.rotarImagen=function(a){return f.put("::myimages/rotarimagen/"+a.id).then(function(b){return a.nombre="",j.success("Imagen rotada"),a.nombre=b+"?"+(new Date).getTime()},function(a){return j.error("Imagen no rotada")})},a.publicarImagen=function(b){return f.put("::myimages/publicar-imagen/"+b.id).then(function(c){return j.info("Ahora la imagen es pública"),a.imagenes_privadas=d("filter")(a.imagenes_privadas,{id:"!"+b.id}),a.imagenes_publicas.push(b)},function(a){return j.error("Imagen no publicada")})},a.privatizarImagen=function(b){return f.put("::myimages/privatizar-imagen/"+b.id).then(function(c){return c=c.data,c.imagen?void j.warning("No puede ser logo del año "+c.imagen.is_logo_of_year):(j.info("Ahora la imagen es privada"),b.user_id===a.USER.id&&a.imagenes_privadas.push(b),a.imagenes_publicas=d("filter")(a.imagenes_publicas,{id:"!"+b.id}))},function(a){return j.error("Imagen no privatizada")})},a.borrarImagen=function(b){var c;return c=h.open({templateUrl:"==fileManager/removeImage.tpl.html",controller:"RemoveImageCtrl",size:"sm",resolve:{imagen:function(){return b},user_id:function(){return a.USER.id},datos_imagen:function(){var c;return c={imagen_id:b.id,user_id:a.USER.id},f.get("::myimages/datos-imagen",c).then(function(b){return a.datos_imagen=b.data},function(a){return j.error("Error al traer datos de imagen","Problema"),{}})}}}),c.result.then(function(b){return b.publica?a.imagenes_publicas=d("filter")(a.imagenes_publicas,{id:"!"+b.id}):a.imagenes_privadas=d("filter")(a.imagenes_privadas,{id:"!"+b.id})})},f.get("::perfiles/usuariosall").then(function(b){return b=b.data,a.usuariosall=b,a.usuariosprofes=d("filter")(b,{tipo:"Pr"},!0),a.dato.usuarioElegido=b[0]},function(a){return j.error("No se pudo traer los usuarios",a)}),f.get("::grupos").then(function(b){return a.grupos=b.data}),a.cambiarImgUnUsuario=function(b,c){var e;return e={imgParaUsuario:c.id},f.put("::perfiles/cambiarimgunusuario/"+b.user_id,e).then(function(e){var f;return f=d("filter")(a.usuariosall,{user_id:b.user_id}),f[0].imagen_id=c.id,f[0].imagen_nombre=c.nombre,j.success("Imagen asignada con éxito")},function(a){return j.error("Error al asignar imagen a usuario","Problema")})},a.usuarioSelect=function(b,c){return a.dato.selectUsuarioModel=b},a.cambiarFotoUnAlumno=function(b,c){var e;return e={imgOficialAlumno:c.id},f.put("::perfiles/cambiarimgunalumno/"+b.alumno_id,e).then(function(e){var f;return f=d("filter")(a.alumnos,{id:b.id}),f[0].foto_id=c.id,f[0].foto_nombre=c.nombre,j.success("Foto oficial asignada con éxito")},function(a){return j.error("Error al asignar foto al alumno","Problema")})},a.cambiarFotoUnProfe=function(a,b){var c;return c={imgOficialProfe:b.id},f.put("::perfiles/cambiarimgunprofe/"+a.persona_id,c).then(function(a){return j.success("Foto oficial asignada con éxito")},function(a){return j.error("Error al asignar foto al profesor","Problema")})},a.pedirCambioFirma=function(a,b){var c;return c={imgFirmaProfe:b.id},f.put("::perfiles/cambiarfirmaunprofe/"+a.persona_id,c).then(function(a){return j.success("Firma asignada con éxito")},function(a){return j.error("Error al asignar foto al profesor","Problema")})}}])}.call(this),function(){angular.module("feryzApp").factory("AuthService",["App","$state","$http","$cookies","Perfil","$rootScope","AUTH_EVENTS","$q","$filter","toastr",function(a,b,c,d,e,f,g,h,i,j){var k;return k={},k.verificando=!1,k.promesa_de_verificacion={},k.verificar=function(){var a;return k.verificando?k.promesa_de_verificacion:(a=h.defer(),e.User().id?a.resolve(e.User()):d.get("xtoken")?void 0!==d.get("xtoken")&&"undefined"!==d.get("xtoken")&&"[object Object]"!==d.get("xtoken")?k.login_from_token().then(function(b){return e.setUser(b),a.resolve(b)},function(b){return console.log("No se logueó from token"),a.reject(b)}):(console.log("Token mal estructurado: ",d.get("xtoken")),k.borrarToken(),f.$broadcast(g.notAuthenticated),a.reject("Token mal estructurado.")):(console.log("No hay cookie token."),a.reject("No hay cookie token."),b.go("login"),f.$broadcast(g.notAuthenticated)),k.promesa_de_verificacion=a.promise,k.promesa_de_verificacion)},k.verificar_acceso=function(){var a,c;return e.User().id||b.go("login"),c=b.current,c.data.needed_permissions?(a=c.data.needed_permissions,k.isAuthorized(a)?void 0:(console.log("No tiene permisos, y... "),f.lastState=c.name,k.isAuthenticated()?(f.$broadcast(g.notAuthorized),console.log("...está Autenticado.")):(console.log("...NO está Autenticado."),b.transitionTo("login")))):!0},k.login_credentials=function(a){var i;return i=h.defer(),k.borrarToken(),c.post("::login/login",a).then(function(a){return a.data.token?(d.put("xtoken",a.data.token),c.defaults.headers.common.Authorization="Bearer "+d.get("xtoken"),e.setUser(a.data),f.$broadcast(g.loginSuccess),i.resolve(a.data)):(f.$broadcast(g.loginFailed),i.reject("Error en login"))},function(a){return f.$broadcast(g.loginFailed),a?a.status?400===a.status?j.error("Datos inválidos","",{timeOut:8e3}):-1===a.status?j.error("No parece haber comunicación con el servidor","",{timeOut:8e3}):500===a.status&&j.error("No parece haber comunicación con la Base de datos","",{timeOut:8e3}):a.data?a.data.error&&("Token expirado"===a.data.error||"token_expired"===a.error?(j.warning("La sesión ha expirado"),"login"!==b.current.name&&b.go("login")):f.$broadcast(g.loginFailed)):j.error("No parece haber comunicación con el servidor"):j.error("No parece haber comunicación con el servidor"),i.reject("Error en login")}),i.promise},k.login_from_token=function(){var a,b;return a=h.defer(),e.User().id||void 0===e.User().id?(c.defaults.headers.common.Authorization="Bearer "+d.get("xtoken"),b=c.post("::login/verificar").then(function(b){return f.$broadcast(g.loginSuccess),a.resolve(b.data)},function(b){return console.log("No se pudo loguear con token. ",b),a.reject("Error en login con token."),f.$broadcast(g.loginFailed)})):a.resolve(e.User()),a.promise},k.logout=function(a){return f.lastState=null,f.lastStateParam=null,k.borrarToken(),e.deleteUser(),b.transitionTo("login")},k.borrarToken=function(){return d.remove("xtoken"),delete c.defaults.headers.common.Authorization},k.isAuthenticated=function(){return!!e.User().id},k.isAuthorized=function(a){var b,c;return c=e.User(),c.is_superuser?!0:(angular.isArray(a)||(a=[a]),angular.isArray(c.perms)?(b=[],_.each(a,function(a){return-1!==c.perms.indexOf(a)?b.push(a):void 0}),k.isAuthenticated()&&b.length>0):a.length>0?!1:!0)},k.hasRoleOrPerm=function(a,b){var c;if(!angular.isArray(a)){if(!a)return!1;a=[a]}return c=[],_.each(a,function(a){var b;return b=[],b=i("filter")(e.User().roles,{name:a}),b&&b.length>0?c.push(a):void 0}),c.length>0},k}])}.call(this),function(){angular.module("feryzApp").factory("Perfil",["App","AUTH_EVENTS","$http",function(a,b,c){var d;return d={},{setUser:function(a){return d=a},User:function(){return d},id:function(){return d.user_id},idioma:function(){return d.idioma_main_id},setImagen:function(a,b){return d.imagen_id=a,d.imagen_nombre=b},deleteUser:function(){return d={}}}}])}.call(this),function(){angular.module("feryzApp").directive("updateTitle",["$rootScope","$timeout",function(a,b){return{link:function(c,d){var e;return e=function(a,c,e){var f;return f="MyVc",c.data&&c.data.pageTitle&&(f=c.data.pageTitle),e&&e.username&&(f=e.username+" - MyVc"),b(function(){return d.text(f)},0,!1)},a.$on("$stateChangeSuccess",e)}}}])}.call(this),function(){angular.module("feryzApp").filter("porIdioma",[function(){return function(a,b){var c,d,e,f,g;if(a){for(g=[],b=parseFloat(b),d=0,f=a.length;f>d;d++)c=a[d],e=parseFloat(c.idioma_id),b===e&&g.push(c);return g}return!1}}])}.call(this);