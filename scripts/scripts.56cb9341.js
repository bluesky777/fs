(function(){"use strict";angular.module("feryzApp",["ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ui.router","ui.bootstrap","ui.select","pascalprecht.translate","angular-loading-bar","toastr","http-auth-interceptor","ui.grid","ui.grid.edit","ui.grid.resizeColumns","ui.grid.exporter","ui.grid.selection","FBAngular","ngMaterial","angular-svg-round-progress","camera","ngFileUpload"]).constant("App",function(){var a,b,c;return a=location.protocol+"//"+location.hostname+"/",location.hostname.match("lalvirtual")&&(a="http://lalvirtual.com/"),c=a+"feryz_server/public/",b=a+"feryz/",{Server:c,views:"views/",images:c+"images/",perfilPath:c+"images/perfil/",imgSystemPath:c+"images/eventos/"}}()).constant("AUTH_EVENTS",{loginSuccess:"auth-login-success",loginFailed:"auth-login-failed",logoutSuccess:"auth-logout-success",sessionTimeout:"auth-session-timeout",notAuthenticated:"auth-not-authenticated",notAuthorized:"auth-not-authorized"}).constant("USER_ROLES",{all:"*",admin:"admin",vendedor:"vendedor",tecnico:"tecnico"}).constant("PERMISSIONS",{can_work_like_admin:"can_work_like_admin",can_work_like_vendedor:"can_work_like_vendedor",can_work_like_tecnico:"can_work_like_tecnico",can_edit_usuarios:"can_edit_usuarios"})}).call(this),function(){"use strict";angular.module("feryzApp").controller("MainCtrl",["$scope","$window","$interval",function(a,b,c){}]).controller("LandingCtrl",["$scope","$window","$interval",function(a,b,c){}])}.call(this),function(){"use strict";angular.module("feryzApp").controller("ApplicationController",["$scope","USER_ROLES","AuthService","toastr","$state","$rootScope","$http","$filter",function(a,b,c,d,e,f,g,h){return a.isAuthorized=c.isAuthorized,a.hasRoleOrPerm=c.hasRoleOrPerm,a.USER_ROLES=b,a.isLoginPage=!1,a.main={skin:21},a.navFull=!0,a.toggleNav=function(){return a.navFull=!a.navFull},a.tema="theme-zero",a.cambiarTema=function(b){return a.tema=b},a.floatingSidebar=0,a.toggleFloatingSidebar=function(){return a.floatingSidebar=a.floatingSidebar?!1:!0}}])}.call(this),function(){angular.module("feryzApp").config(["$cookiesProvider","$stateProvider","$urlRouterProvider","$httpProvider","$locationProvider","App","PERMISSIONS","$intervalProvider","$rootScopeProvider","USER_ROLES","toastrConfig","uiSelectConfig",function(a,b,c,d,e,f,g,h,i,j,k,l){return d.defaults.useXDomain=!0,delete d.defaults.headers.common["X-Requested-With"],d.defaults.headers.common.Accept="application/json",d.defaults.headers.common["Content-Type"]="application/json",d.interceptors.push(["$q",function(a){return{request:function(a){var b;return b=a.url.split("::"),b.length>1?a.url=f.Server+b[1]:(b=a.url.split("=="),b.length>1&&(a.url=f.views+b[1])),a}}}]),l.theme="select2",l.resetSearchInput=!0,c.otherwise("/login"),b.state("main",{url:"/",views:{principal:{templateUrl:f.views+"main/main.tpl.html",controller:"MainCtrl"}},data:{pageTitle:"En Construcción"}}).state("landing",{url:"/landing",views:{principal:{templateUrl:f.views+"main/landing.tpl.html",controller:"LandingCtrl"}},data:{pageTitle:"Inicio Feryz"}}).state("login",{url:"/login",views:{principal:{templateUrl:f.views+"login/login.tpl.html",controller:"LoginCtrl"}},data:{pageTitle:"Ingresar a Feryz"}}).state("logout",{url:"/logout",views:{principal:{templateUrl:f.views+"login/logout.tpl.html",controller:"LogoutCtrl"}},data:{icon_fa:"fa fa-user"}}),i.bigLoader=!0,_.mixin({findByValues:function(a,b,c){var d;return d=_.filter(a,function(a){return _.contains(c,a[b])}),0===d.length?!1:d[0]}}),angular.extend(k,{allowHtml:!0,closeButton:!0,extendedTimeOut:1e3,preventOpenDuplicates:!1,maxOpened:3,tapToDismiss:!0,target:"body",timeOut:4e3}),this}]).filter("capitalize",function(){return function(a,b){return a?a.replace(/([^\W_]+[^\s-]*) */g,function(a){return a.charAt(0).toUpperCase()+a.substr(1).toLowerCase()}):""}})}.call(this),function(){angular.module("feryzApp").run(["$rootScope","cfpLoadingBar","$state","$stateParams","$translate","$cookies","Perfil","AuthService","AUTH_EVENTS","toastr",function(a,b,c,d,e,f,g,h,i,j){var k;return a.examen_actual=[],a.$state=c,a.$stateParams=d,a.lastState=null,a.lastStateParam=null,a.$on("event:auth-loginRequired",function(a){return console.log("Acceso no permitido, vamos a loguear",a),c.transitionTo("login")}),k=function(){return null===a.lastState||"login"===a.lastState||"/"===a.lastState||"main"===a.lastState?c.go("panel"):c.go(a.lastState,a.lastStateParam)},a.$on("event:auth-loginConfirmed",function(){return console.log("Logueado con éxito!"),k()}),a.$on("$stateChangeStart",function(b,c,d,e,f){return null===a.lastState||"logout"!==c.name&&"login"!==c.name&&"main"!==c.name?(a.lastState=c.name,a.lastStateParam=d):void 0}),a.$on("$stateChangeSuccess",function(b,d,e,f,g){return a.pageTitle=c.current.name}),a.$on("$stateChangeError",function(b,d,e,f,g){return console.log(a.lastState,"-Evento fallido: ",b),j.warning("Lo sentimos, hubo un error o no puedes acceder a esta vista"),"panel"!==a.lastState?c.transitionTo("panel"):c.transitionTo("login")}),a.$on("$translatePartialLoaderStructureChanged",function(){return e.refresh(),console.log("Translate refrescado supuestamente.")}),a.$on(i.loginSuccess,function(){return k()}),a.$on(i.loginFailed,function(a){}),a.$on(i.notAuthenticated,function(a){return j.warning("No está autorizado.","Acceso exclusivo"),console.log("Evento notAuthenticated: ",a),c.transitionTo("login")}),a.$on(i.notAuthorized,function(b){return j.warning("No está autorizado para entrar a esta vista","Restringido"),c.go("panel"),console.log("Evento notAuthorized: ",b,a.lastState)})}])}.call(this),function(){"use strict";angular.module("feryzApp").config(["$stateProvider","App","USER_ROLES","PERMISSIONS","$translateProvider",function(a,b,c,d,e){return e.translations("EN",{LOGIN_MSG:"Sign In to the panel"}).translations("ES",{LOGIN_MSG:"Ingresa al panel"})}])}.call(this),function(){"use strict";angular.module("feryzApp").controller("LoginCtrl",["$scope","$rootScope","AUTH_EVENTS","AuthService","$location","$cookies","Perfil","App","$state","cfpLoadingBar",function(a,b,c,d,e,f,g,h,i,j){a.logoPath="images/MyVc-1.gif",a.credentials={username:"",password:""},j.complete(),a.login=function(){var b;return b=d.login_credentials(a.credentials),b.then(function(a){i.go("panel")},function(a){return console.log("Promise de login_credentials rechazada",a)})}}])}.call(this),function(){"use strict";angular.module("feryzApp").config(["$stateProvider","App","USER_ROLES","PERMISSIONS","$translateProvider",function(a,b,c,d,e){a.state("panel",{url:"/panel",views:{principal:{templateUrl:b.views+"panel/panel.tpl.html",controller:"PanelCtrl"}},resolve:{resolved_user:["AuthService",function(a){return a.verificar()}]},data:{pageTitle:"Feryz - Bienvenido"}}),e.preferredLanguage("ES"),e.translations("EN",{INICIO_MENU:"Home",USERS_MENU:"Users",EVENTS_MENU:"Events",ENTIDADES_MENU:"Entities",CATEGS_MENU:"Categories",PREGUNTAS_MENU:"Questions",EVALUACIONES_MENU:"Tests",IDIOMA_MENU:"Language",INFORMES_MENU:"Reports",SALIR:"Sign out",ELIMINATORIAS:"Playoffs",GRAN_FINAL:"Great ultimate",INSCRITO_EN:"You are signed in:",NO_ESTAS_INSCRITO:"You are`t signed in any category.",EXAM_HECHOS:"Done Exams"}).translations("ES",{INICIO_MENU:"Inicio",EVENTS_MENU:"Eventos",ENTIDADES_MENU:"Entidades",CATEGS_MENU:"Categorías",PREGUNTAS_MENU:"Preguntas",EVALUACIONES_MENU:"Evaluaciones",USERS_MENU:"Usuarios",IDIOMA_MENU:"Idioma",INFORMES_MENU:"Informes",SALIR:"Salir",ELIMINATORIAS:"Eliminatorias",GRAN_FINAL:"Gran final",INSCRITO_EN:"Estás inscrito en:",NO_ESTAS_INSCRITO:"No estás inscrito en ninguna categoría.",EXAM_HECHOS:"Exámenes hechos"}).translations("PT",{INICIO_MENU:"Iniciação",EVENTS_MENU:"Eventos",ENTIDADES_MENU:"Entidades",CATEGS_MENU:"Categorias",PREGUNTAS_MENU:"Interrogatório",EVALUACIONES_MENU:"Evaluations",USERS_MENU:"Usuários",IDIOMA_MENU:"Língua",INFORMES_MENU:"Informação",SALIR:"Deixar",ELIMINATORIAS:"Playoffs",GRAN_FINAL:"Grande final",INSCRITO_EN:"Você está matriculado:",NO_ESTAS_INSCRITO:"Você não está registrado em qualquer categoria.",EXAM_HECHOS:"Testes feitos"})}])}.call(this),function(){"use strict";angular.module("feryzApp").controller("PanelCtrl",["$scope","$http","$state","$cookies","$rootScope","AuthService","Perfil","App","resolved_user","toastr","$translate","$filter","$uibModal","Fullscreen",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){a.USER=i,a.imagesPath=h.images+"perfil/",f.verificar_acceso(),e.$on("$stateChangeSuccess",function(b,c,d,e,f){return a.cambiarTema("theme-zero")}),a.openMenu=function(a,b){var c;return c=b,a(b)},a.gotoFilemanager=function(){return c.go("panel.filemanager")},a.gotoUsuarios=function(){return c.go("panel.usuarios")},a.set_user_event=function(c){return b.put("eventos/set-user-event",{evento_id:c.id}).then(function(b){return console.log("Evento cambiado: ",b),a.USER.evento_selected_id=c.id,a.el_evento_actual(),j.success("Evento actual cambiado por "+c.alias),e.$broadcast("cambio_evento_user")},function(a){return console.log("Error conectando!",a),j.warning("No se pudo cambiar el evento actual.")})},a.logout=function(){return f.logout(),b.put("login/logout").then(function(a){return console.log("Desconectado con éxito: ",a)},function(a){return console.log("Error desconectando!",a)})},a.setImagenPrincipal=function(){var b,c,d;return c=h.images+"perfil/",b=a.USER.image_nombre,d=c+b,a.imagenPrincipal=d},a.setImagenPrincipal(),a.$on("cambianImgs",function(b,c){return console.log(g.User()),a.USER=g.User(),a.setImagenPrincipal()}),a.setFullScreen=function(){return n.toggleAll()}}])}.call(this),function(){angular.module("feryzApp").config(["$stateProvider","App",function(a,b){return a.state("panel.usuarios",{url:"^/usuarios",views:{contenido_panel:{templateUrl:b.views+"usuarios/usuarios.tpl.html",controller:"UsuariosCtrl"}},data:{pageTitle:"Usuarios - Feryz",needed_roles:[10]}})}])}.call(this),function(){angular.module("feryzApp").controller("UsuariosCtrl",["$scope","$http","App","$filter","toastr","AuthService","$uibModal",function(a,b,c,d,e,f,g){var h,i;return f.verificar_acceso(),a.creando=!1,a.editando=!1,a.guardando=!1,a.usuarioActualizar={},a.tipos_doc=[{id:1,tipo:"Cédula"},{id:2,tipo:"Cédula extranjera"},{id:3,tipo:"Tarjeta de identidad"}],a.tipos_usuarios=[{id:1,tipo:"Administrador"},{id:2,tipo:"Vendedor"},{id:3,tipo:"Técnico"}],a.usuarioNuevo={sexo:"M",password:"",password_confirm:"",tipo_doc:{id:1,tipo:"Cédula"}},b.get("::paises/all").then(function(b){return a.paises=b.data,a.usuarioNuevo.pais=d("filter")(a.paises,{id:1})[0],a.usuarioNuevo.pais_doc=d("filter")(a.paises,{id:1})[0],a.paisSeleccionado(a.usuarioNuevo.pais),a.paisdocSeleccionado(a.usuarioNuevo.pais_doc)},function(){return e.error("No se pudo traer las ciudades.")}),a.paisSeleccionado=function(c,d){return b.get("::ciudades/departamentos",{params:{pais_id:c.id}}).then(function(b){return a.departamentos=b.data},function(){return e.error("No se pudo traer las ciudades.")})},a.paisdocSeleccionado=function(c,d){return b.get("::ciudades/departamentos",{params:{pais_id:c.id}}).then(function(b){return a.departamentos_doc=b.data},function(){return e.error("No se pudo traer las ciudades.")})},a.departamentoSeleccionado=function(c,d){return b.get("::ciudades/ciudades",{params:{departamento:c.departamento}}).then(function(b){return a.ciudades=b.data},function(){return e.error("No se pudo traer las ciudades.")})},a.departamentoDocSeleccionado=function(c,d){return b.get("::ciudades/ciudades",{params:{departamento:c.departamento}}).then(function(b){return a.ciudades_doc=b.data},function(){return e.error("No se pudo traer las ciudades.")})},a.crearUsuario=function(){return a.creando=!0,a.editando=!1},a.guardarUsuario=function(){return a.guardando=!0,a.usuarioNuevo.password!==a.usuarioNuevo.password_confirm?(e.warning("La contraseña y confirmación no coinciden"),a.guardando=!1,!1):a.usuarioNuevo.password.length<3?(e.warning("La contraseña debe tener al menos 3 caracteres"),a.guardando=!1,!1):b.post("::usuarios/guardar",a.usuarioNuevo).then(function(b){return a.opcionesGrid.data.push(b.data),e.success("Creado correctamente: "+b.data.nombres),a.creando=!1,a.guardando=!1},function(b){return a.guardando=!1,e.error("No se pudo crear usuario","Error")})},a.eliminarUsuario=function(b){var c;return c=g.open({templateUrl:"==usuarios/removeUsuario.tpl.html",controller:"RemoveUsuarioCtrl",resolve:{usuario:function(){return b}}}),c.result.then(function(b){return a.opcionesGrid.data=d("filter")(a.opcionesGrid.data,{id:"!"+b.id})})},a.actualizarUsuario=function(c){if(a.guardando=!0,""!==a.usuarioActualizar.password&&""!==a.usuarioActualizar.password_confirm){if(a.usuarioActualizar.password!==a.usuarioActualizar.password_confirm)return e.warning("La contraseña y confirmación no coinciden"),a.guardando=!1,!1;if(a.usuarioActualizar.password.length<3)return e.warning("La contraseña debe tener al menos 3 caracteres"),a.guardando=!1,!1}return b.put("::usuarios/actualizar",a.usuarioActualizar).then(function(b){return e.success("Actualizado correctamente: "+a.usuarioActualizar.nombres),a.editando=!1,a.guardando=!1,a.usuarioActualizar.anterior.tipo=a.usuarioActualizar.tipo.id,a.usuarioActualizar.anterior.tipo_doc=a.usuarioActualizar.tipo_doc.id},function(b){return a.guardando=!1,e.error("No se pudo actualizar","Error")})},a.editarUsuario=function(c){var e,f;return a.creando=!1,a.editando=!0,angular.copy(c,a.usuarioActualizar),a.usuarioActualizar.anterior=c,a.usuarioActualizar.password="",a.usuarioActualizar.password_confirm="",e=d("filter")(a.tipos_doc,{tipo:a.usuarioActualizar.tipo_doc},!0),e=e.length>0?e[0]:a.tipos_doc[0],a.usuarioActualizar.tipo_doc=e,f=d("filter")(a.tipos_usuarios,{tipo:a.usuarioActualizar.tipo},!0),f=f.length>0?f[0]:a.tipos_usuarios[0],a.usuarioActualizar.tipo=f,null===a.usuarioActualizar.ciudad_nac?(a.usuarioActualizar.pais={id:1,pais:"COLOMBIA",abrev:"CO"},a.paisSeleccionado(a.usuarioActualizar.pais,a.usuarioActualizar.pais)):b.get("::ciudades/datosciudad/"+a.usuarioActualizar.ciudad_nac).then(function(b){return a.paises=b.data.paises,a.departamentosNac=b.data.departamentos,a.ciudadesNac=b.data.ciudades,a.usuarioActualizar.pais=b.data.pais,a.usuarioActualizar.depart_nac=b.data.departamento,a.usuarioActualizar.ciudad_nac=b.data.ciudad}),null===a.usuarioActualizar.ciudad_doc?(a.usuarioActualizar.pais_doc={id:1,pais:"COLOMBIA",abrev:"CO"},a.paisSeleccionado(a.usuarioActualizar.pais_doc,a.usuarioActualizar.pais_doc)):b.get("::ciudades/datosciudad/"+a.usuarioActualizar.ciudad_doc).then(function(b){return a.paises=b.data.paises,a.departamentosNac=b.data.departamentos,a.ciudadesNac=b.data.ciudades,a.usuarioActualizar.pais_doc=b.data.pais,a.usuarioActualizar.depart_doc=b.data.departamento,a.usuarioActualizar.ciudad_doc=b.data.ciudad})},a.traerUsuarios=function(){return b.get("::usuarios/all").then(function(b){return a.opcionesGrid.data=b.data},function(a){return console.log("No se pudo traer los usuarios",a)})},a.traerUsuarios(),h='<a class="btn btn-default btn-xs" ng-click="grid.appScope.editarUsuario(row.entity)"><md-tooltip md-direction="left">Editar</md-tooltip><i class="fa fa-edit "></i>Modificar</a>',i='<a class="btn btn-default btn-xs" ng-click="grid.appScope.eliminarUsuario(row.entity)"><md-tooltip md-direction="left">Eliminar</md-tooltip><i class="fa fa-times "></i></a>',a.opcionesGrid={showGridFooter:!0,enableSorting:!0,columnDefs:[{field:"id",width:60,enableCellEdit:!1},{field:"Edición",cellTemplate:h+i,width:120,enableCellEdit:!1},{field:"nombres",minWidth:100},{field:"apellidos",minWidth:100},{field:"sexo",width:50},{field:"username",displayName:"Usuario"},{field:"email"},{field:"fecha_nac",type:"date",format:"yyyy-mm-dd"}],onRegisterApi:function(c){return a.gridApi=c,c.edit.on.afterCellEdit(a,function(c,d,f,g){return f!==g&&("sexo"===d.field?"M"===f||"F"===f?b.put("::usuarios/actualizar/"+c.id,c).then(function(a){return e.success("Usuario actualizado con éxito","Actualizado")},function(a){return e.error("Cambio no guardado","Error"),console.log("Falló al intentar guardar: ",a)}):(a.toastr.warning("Debe usar M o F"),c.sexo=g):b.put("::usuarios/actualizar/"+c.id,c).then(function(a){return e.success("Usuario actualizado con éxito","Actualizado")},function(a){return e.error("Cambio no guardado","Error"),console.log("Falló al intentar guardar: ",a)})),a.$apply()})}}}]).controller("RemoveUsuarioCtrl",["$scope","$uibModalInstance","usuario","$http","toastr",function(a,b,c,d,e){return a.usuario=c,a.ok=function(){return d["delete"]("::usuarios/destroy/"+c.id).then(function(a){return e.success("Usuario eliminado: "+c.nombres,"Eliminado")},function(a){return e.warning("Problema","No se pudo eliminar el usuario.")}),b.close(c)},a.cancel=function(){return b.dismiss("cancel")}}])}.call(this),function(){angular.module("feryzApp").config(["$stateProvider","App",function(a,b){return a.state("panel.proveedores",{url:"^/proveedores",views:{contenido_panel:{templateUrl:b.views+"proveedores_clientes/proveedores.tpl.html",controller:"ProveedoresCtrl"}},data:{pageTitle:"Proveedores - Feryz"}}),a.state("panel.clientes",{url:"^/clientes",views:{contenido_panel:{templateUrl:b.views+"proveedores_clientes/clientes.tpl.html",controller:"ClientesCtrl"}},data:{pageTitle:"Clientes - Feryz"}})}])}.call(this),function(){angular.module("feryzApp").controller("ProveedoresCtrl",["$scope","$http","App","$filter","toastr","AuthService","$uibModal",function(a,b,c,d,e,f,g){var h,i;return f.verificar_acceso(),a.creando=!1,a.editando=!1,a.guardando=!1,a.provActualizar={},a.provNuevo={sexo:"M",password:"",password_confirm:"",tipo_doc:{id:1,tipo:"Cédula"}},b.get("::paises/all").then(function(b){return a.paises=b.data,a.provNuevo.pais=d("filter")(a.paises,{id:1})[0],a.paisSeleccionado(a.provNuevo.pais)},function(){return e.error("No se pudo traer las ciudades.")}),a.paisSeleccionado=function(c,d){return b.get("::ciudades/departamentos",{params:{pais_id:c.id}}).then(function(b){return a.departamentos=b.data},function(){return e.error("No se pudo traer las ciudades.")})},a.departamentoSeleccionado=function(c,d){return b.get("::ciudades/ciudades",{params:{departamento:c.departamento}}).then(function(b){return a.ciudades=b.data},function(){return e.error("No se pudo traer las ciudades.")})},a.crearProveedor=function(){return a.creando=!0,a.editando=!1},a.guardarProveedor=function(){return a.guardando=!0,b.post("::proveedores/guardar",a.provNuevo).then(function(b){return a.opcionesGrid.data.push(b.data),e.success("Creado correctamente: "+b.data.nombre),a.creando=!1,a.guardando=!1},function(b){return a.guardando=!1,e.error("No se pudo crear proveedor","Error")})},a.eliminarProveedor=function(b){var c;return c=g.open({templateUrl:"==proveedores_clientes/removeProveedor.tpl.html",controller:"RemoveProveedorCtrl",resolve:{proveedor:function(){return b}}}),c.result.then(function(b){return a.opcionesGrid.data=d("filter")(a.opcionesGrid.data,{id:"!"+b.id})})},a.actualizarProveedor=function(c){return a.guardando=!0,b.put("::proveedores/actualizar",a.provActualizar).then(function(b){return e.success("Actualizado correctamente: "+a.provActualizar.nombre),a.editando=!1,a.guardando=!1},function(b){return a.guardando=!1,e.error("No se pudo actualizar","Error")})},a.editarProveedor=function(c){return a.creando=!1,a.editando=!0,angular.copy(c,a.provActualizar),a.provActualizar.anterior=c,null===a.provActualizar.ciudad_id?(a.provActualizar.pais={id:1,pais:"COLOMBIA",abrev:"CO"},a.paisSeleccionado(a.provActualizar.pais,a.provActualizar.pais)):b.get("::ciudades/datosciudad/"+a.provActualizar.ciudad_id).then(function(b){return a.paises=b.data.paises,a.departamentos=b.data.departamentos,a.ciudades=b.data.ciudades,a.provActualizar.pais=b.data.pais,a.provActualizar.departamento=b.data.departamento,a.provActualizar.ciudad=b.data.ciudad})},a.traerProveedores=function(){return b.get("::proveedores/all").then(function(b){return a.opcionesGrid.data=b.data},function(a){return console.log("No se pudo traer los proveedores",a)})},a.traerProveedores(),h='<a class="btn btn-default btn-xs" ng-click="grid.appScope.editarProveedor(row.entity)"><md-tooltip md-direction="left">Editar</md-tooltip><i class="fa fa-edit "></i>Modificar</a>',i='<a class="btn btn-default btn-xs" ng-click="grid.appScope.eliminarProveedor(row.entity)"><md-tooltip md-direction="left">Eliminar</md-tooltip><i class="fa fa-times "></i></a>',a.opcionesGrid={showGridFooter:!0,enableSorting:!0,columnDefs:[{field:"id",width:60,enableCellEdit:!1},{field:"Edición",cellTemplate:h+i,width:120,enableCellEdit:!1},{field:"nombre",minWidth:100},{field:"direccion",displayName:"Dirección",minWidth:100},{field:"persona_contacto",displayName:"Persona contacto",minWidth:100},{field:"email"},{field:"telefono1"}],onRegisterApi:function(c){return a.gridApi=c,c.edit.on.afterCellEdit(a,function(c,d,f,g){return f!==g&&b.put("::proveedores/actualizar/"+c.id,c).then(function(a){return e.success("Proveedor actualizado con éxito","Actualizado")},function(a){return e.error("Cambio no guardado","Error"),console.log("Falló al intentar guardar: ",a)}),a.$apply()})}}}]).controller("RemoveProveedorCtrl",["$scope","$uibModalInstance","proveedor","$http","toastr",function(a,b,c,d,e){return a.proveedor=c,a.ok=function(){return d["delete"]("::proveedores/destroy/"+c.id).then(function(a){return e.success("Proveedor eliminado: "+c.nombre,"Eliminado")},function(a){return e.warning("Problema","No se pudo eliminar el proveedor.")}),b.close(c)},a.cancel=function(){return b.dismiss("cancel")}}])}.call(this),function(){angular.module("feryzApp").controller("ClientesCtrl",["$scope","$http","App","$filter","toastr","AuthService","$uibModal",function(a,b,c,d,e,f,g){var h,i;return f.verificar_acceso(),a.creando=!1,a.editando=!1,a.guardando=!1,a.clieActualizar={},a.clieNuevo={sexo:"M",password:"",password_confirm:"",tipo_doc:{id:1,tipo:"Cédula"}},b.get("::paises/all").then(function(b){return a.paises=b.data,a.clieNuevo.pais=d("filter")(a.paises,{id:1})[0],a.paisSeleccionado(a.clieNuevo.pais)},function(){return e.error("No se pudo traer las ciudades.")}),a.paisSeleccionado=function(c,d){return b.get("::ciudades/departamentos",{params:{pais_id:c.id}}).then(function(b){return a.departamentos=b.data},function(){return e.error("No se pudo traer las ciudades.")})},a.departamentoSeleccionado=function(c,d){return b.get("::ciudades/ciudades",{params:{departamento:c.departamento}}).then(function(b){return a.ciudades=b.data},function(){return e.error("No se pudo traer las ciudades.")})},a.crearCliente=function(){return a.creando=!0,a.editando=!1},a.guardarCliente=function(){return a.guardando=!0,b.post("::clientes/guardar",a.clieNuevo).then(function(b){return a.opcionesGrid.data.push(b.data),e.success("Creado correctamente: "+b.data.nombre),a.creando=!1,a.guardando=!1},function(b){return a.guardando=!1,e.error("No se pudo crear Cliente","Error")})},a.eliminarCliente=function(b){var c;return c=g.open({templateUrl:"==proveedores_clientes/removeCliente.tpl.html",controller:"RemoveClienteCtrl",resolve:{cliente:function(){return b}}}),c.result.then(function(b){return a.opcionesGrid.data=d("filter")(a.opcionesGrid.data,{id:"!"+b.id})})},a.actualizarCliente=function(c){return a.guardando=!0,b.put("::clientes/actualizar",a.clieActualizar).then(function(b){return e.success("Actualizado correctamente: "+a.clieActualizar.nombre),a.editando=!1,a.guardando=!1},function(b){return a.guardando=!1,e.error("No se pudo actualizar","Error")})},a.editarCliente=function(c){return a.creando=!1,a.editando=!0,angular.copy(c,a.clieActualizar),a.clieActualizar.anterior=c,null===a.clieActualizar.ciudad_id?(a.clieActualizar.pais={id:1,pais:"COLOMBIA",abrev:"CO"},a.paisSeleccionado(a.clieActualizar.pais,a.clieActualizar.pais)):b.get("::ciudades/datosciudad/"+a.clieActualizar.ciudad_id).then(function(b){return a.paises=b.data.paises,a.departamentos=b.data.departamentos,a.ciudades=b.data.ciudades,a.clieActualizar.pais=b.data.pais,a.clieActualizar.departamento=b.data.departamento,a.clieActualizar.ciudad=b.data.ciudad})},a.traerClientes=function(){return b.get("::clientes/all").then(function(b){return a.opcionesGrid.data=b.data},function(a){return console.log("No se pudo traer los clientes",a)})},a.traerClientes(),h='<a class="btn btn-default btn-xs" ng-click="grid.appScope.editarCliente(row.entity)"><md-tooltip md-direction="left">Editar</md-tooltip><i class="fa fa-edit "></i>Modificar</a>',i='<a class="btn btn-default btn-xs" ng-click="grid.appScope.eliminarCliente(row.entity)"><md-tooltip md-direction="left">Eliminar</md-tooltip><i class="fa fa-times "></i></a>',a.opcionesGrid={showGridFooter:!0,enableSorting:!0,columnDefs:[{field:"id",width:60,enableCellEdit:!1},{field:"Edición",cellTemplate:h+i,width:120,enableCellEdit:!1},{field:"nombre",minWidth:100},{field:"direccion",displayName:"Dirección",minWidth:100},{field:"persona_contacto",displayName:"Persona contacto",minWidth:100},{field:"email"},{field:"telefono1"}],onRegisterApi:function(c){return a.gridApi=c,c.edit.on.afterCellEdit(a,function(c,d,f,g){return f!==g&&b.put("::clientes/actualizar/"+c.id,c).then(function(a){return e.success("Cliente actualizado con éxito","Actualizado")},function(a){return e.error("Cambio no guardado","Error"),console.log("Falló al intentar guardar: ",a)}),a.$apply()})}}}]).controller("RemoveClienteCtrl",["$scope","$uibModalInstance","cliente","$http","toastr",function(a,b,c,d,e){return a.cliente=c,a.ok=function(){return d["delete"]("::clientes/destroy/"+c.id).then(function(a){return e.success("Cliente eliminado: "+c.nombre,"Eliminado")},function(a){return e.warning("Problema","No se pudo eliminar el cliente.")}),b.close(c)},a.cancel=function(){return b.dismiss("cancel")}}])}.call(this),function(){angular.module("feryzApp").config(["$stateProvider","App",function(a,b){return a.state("panel.productos",{url:"^/productos",views:{contenido_panel:{templateUrl:b.views+"productos/productos.tpl.html",controller:"ProductosCtrl"}},data:{pageTitle:"Productos - Feryz"}}),a.state("panel.categorias",{url:"^/categorias",views:{contenido_panel:{templateUrl:b.views+"productos/categorias.tpl.html",controller:"CategoriasCtrl"}},data:{pageTitle:"Categorías - Feryz"}})}])}.call(this),function(){angular.module("feryzApp").controller("ProductosCtrl",["$scope","$http","App","$filter","toastr","AuthService","$uibModal",function(a,b,c,d,e,f,g){var h,i;return f.verificar_acceso(),a.creando=!1,a.editando=!1,a.guardando=!1,a.prodActualizar={},a.unidades=[{unidad:"-"},{unidad:"metros"},{unidad:"rollos"}],a.categorias=[],a.prodNuevo={unidad_medida:{unidad:"-"}},a.crearProducto=function(){return a.creando=!0,a.editando=!1},a.guardarProducto=function(){return a.guardando=!0,b.post("::productos/guardar",a.prodNuevo).then(function(b){return a.opcionesGrid.data.push(b.data),e.success("Creado correctamente: "+b.data.nombre),a.creando=!1,a.guardando=!1},function(b){return a.guardando=!1,e.error("No se pudo crear Producto","Error")})},a.eliminarProducto=function(b){var c;return c=g.open({templateUrl:"==productos/removeProducto.tpl.html",controller:"RemoveProductoCtrl",resolve:{producto:function(){return b}}}),c.result.then(function(b){return a.opcionesGrid.data=d("filter")(a.opcionesGrid.data,{id:"!"+b.id})})},a.actualizarProducto=function(c){return a.guardando=!0,b.put("::productos/actualizar",a.prodActualizar).then(function(b){return e.success("Actualizado correctamente: "+a.prodActualizar.nombre),a.editando=!1,a.guardando=!1},function(b){return a.guardando=!1,e.error("No se pudo actualizar","Error")})},a.editarProducto=function(b){var c,e;return a.creando=!1,a.editando=!0,angular.copy(b,a.prodActualizar),a.prodActualizar.anterior=b,c=d("filter")(a.categorias,{id:a.prodActualizar.categoria_id},!0)[0],a.prodActualizar.categoria=c,e=d("filter")(a.unidades,{unidad:a.prodActualizar.unidad_medida},!0)[0],a.prodActualizar.unidad_medida=e},a.traerProductos=function(){return b.get("::categorias/all").then(function(b){return a.categorias=b.data,a.opcionesGrid.columnDefs[3].editDropdownOptionsArray=a.categorias},function(a){return console.log("No se pudo traer las categorías",a)}),b.get("::productos/all").then(function(b){return a.opcionesGrid.data=b.data},function(a){return console.log("No se pudo traer los productos",a)})},a.traerProductos(),h='<a class="btn btn-default btn-xs" ng-click="grid.appScope.editarProducto(row.entity)"><md-tooltip md-direction="left">Editar</md-tooltip><i class="fa fa-edit "></i>Modificar</a>',i='<a class="btn btn-default btn-xs" ng-click="grid.appScope.eliminarProducto(row.entity)"><md-tooltip md-direction="left">Eliminar</md-tooltip><i class="fa fa-times "></i></a>',a.opcionesGrid={showGridFooter:!0,enableSorting:!0,enableFiltering:!0,columnDefs:[{field:"id",width:60,enableCellEdit:!1},{field:"Edición",cellTemplate:h+i,width:120,enableCellEdit:!1},{field:"nombre",minWidth:100},{field:"categoria_id",displayName:"Categoría",cellFilter:"mapCategorias:grid.appScope.categorias",filter:{condition:function(b,c){var e,f;return f=d("filter")(a.categorias,{nombre:b}),e=d("filter")(f,{id:c},!0),e.length>0}},editableCellTemplate:"ui-grid/dropdownEditor",editDropdownIdLabel:"id",editDropdownValueLabel:"nombre",enableCellEditOnFocus:!0},{field:"precio_compra"},{field:"precio_venta"}],onRegisterApi:function(c){return a.gridApi=c,c.edit.on.afterCellEdit(a,function(c,d,f,g){return f!==g&&b.put("::productos/actualizar/"+c.id,c).then(function(a){return e.success("Producto actualizado con éxito","Actualizado")},function(a){return e.error("Cambio no guardado","Error"),console.log("Falló al intentar guardar: ",a)}),a.$apply()})}}}]).controller("RemoveProductoCtrl",["$scope","$uibModalInstance","Producto","$http","toastr",function(a,b,c,d,e){return a.Producto=c,a.ok=function(){return d["delete"]("::productos/destroy/"+c.id).then(function(a){return e.success("Producto eliminado: "+c.nombre,"Eliminado")},function(a){return e.warning("Problema","No se pudo eliminar el Producto.")}),b.close(c)},a.cancel=function(){return b.dismiss("cancel")}}]).filter("mapCategorias",["$filter",function(a){return function(b,c){var d;return b?(d=a("filter")(c,{id:b},!0)[0],d?d.nombre:"En papelera..."):"Elija..."}}])}.call(this),function(){angular.module("feryzApp").controller("CategoriasCtrl",["$scope","$http","App","$filter","toastr","AuthService","$uibModal",function(a,b,c,d,e,f,g){var h,i;return f.verificar_acceso(),a.creando=!1,a.editando=!1,a.guardando=!1,a.cateActualizar={},a.cateNuevo={},a.crearCategoria=function(){return a.creando=!0,a.editando=!1},a.guardarCategoria=function(){return a.guardando=!0,b.post("::categorias/guardar",a.cateNuevo).then(function(b){return a.opcionesGrid.data.push(b.data),e.success("Creado correctamente: "+b.data.nombre),a.creando=!1,a.guardando=!1},function(b){return a.guardando=!1,e.error("No se pudo crear categoría","Error")})},a.eliminarCategoria=function(b){var c;return c=g.open({templateUrl:"==productos/removeCategoria.tpl.html",controller:"RemoveCategoriaCtrl",resolve:{categoria:function(){return b}}}),c.result.then(function(b){return a.opcionesGrid.data=d("filter")(a.opcionesGrid.data,{id:"!"+b.id})})},a.actualizarCategoria=function(c){return a.guardando=!0,b.put("::categorias/actualizar",a.cateActualizar).then(function(b){return e.success("Actualizado correctamente: "+a.cateActualizar.nombre),a.editando=!1,a.guardando=!1},function(b){return a.guardando=!1,e.error("No se pudo actualizar","Error")})},a.editarCategoria=function(b){return a.creando=!1,a.editando=!0,angular.copy(b,a.cateActualizar),a.cateActualizar.anterior=b},a.traerCategorias=function(){return b.get("::categorias/all").then(function(b){return a.opcionesGrid.data=b.data},function(a){return console.log("No se pudo traer los categorías",a)})},a.traerCategorias(),h='<a class="btn btn-default btn-xs" ng-click="grid.appScope.editarCategoria(row.entity)"><md-tooltip md-direction="left">Editar</md-tooltip><i class="fa fa-edit "></i>Modificar</a>',i='<a class="btn btn-default btn-xs" ng-click="grid.appScope.eliminarCategoria(row.entity)"><md-tooltip md-direction="left">Eliminar</md-tooltip><i class="fa fa-times "></i></a>',
a.opcionesGrid={showGridFooter:!0,enableSorting:!0,columnDefs:[{field:"id",width:60,enableCellEdit:!1},{field:"Edición",cellTemplate:h+i,width:120,enableCellEdit:!1},{field:"nombre",minWidth:100}],onRegisterApi:function(c){return a.gridApi=c,c.edit.on.afterCellEdit(a,function(c,d,f,g){return f!==g&&b.put("::categorias/actualizar/"+c.id,c).then(function(a){return e.success("categoria actualizado con éxito","Actualizado")},function(a){return e.error("Cambio no guardado","Error"),console.log("Falló al intentar guardar: ",a)}),a.$apply()})}}}]).controller("RemoveCategoriaCtrl",["$scope","$uibModalInstance","categoria","$http","toastr",function(a,b,c,d,e){return a.categoria=c,a.ok=function(){return d["delete"]("::categorias/destroy/"+c.id).then(function(a){return e.success("Categoría eliminado: "+c.nombre,"Eliminado")},function(a){return e.warning("Problema","No se pudo eliminar el categoria.")}),b.close(c)},a.cancel=function(){return b.dismiss("cancel")}}])}.call(this),function(){"use strict";angular.module("feryzApp").config(["$stateProvider","App","USER_ROLES","PERMISSIONS","$translateProvider",function(a,b,c,d,e){a.state("panel.informes",{url:"^/informes/",views:{contenido_panel:{templateUrl:"==informes/informes.tpl.html",controller:"InformesCtrl"}},data:{pageTitle:"Informes"}}).state("panel.informes.ver_usuarios",{url:"ver_usuarios",views:{report_content:{templateUrl:"==informes/verUsuarios.tpl.html",controller:"VerUsuariosCtrl",resolve:{usuarios:["$http","$stateParams",function(a,b){return a.get("::usuarios/all")}]}}},data:{pageTitle:"Usuarios - Feryz"}}).state("panel.informes.ver_productos",{url:"ver_productos",views:{report_content:{templateUrl:"==informes/verProductos.tpl.html",controller:"VerProductosCtrl",resolve:{productos:["$http","$stateParams",function(a,b){return a.get("::productos/all")}]}}},data:{pageTitle:"Productos - Feryz"}}).state("panel.informes.ver_proveedores",{url:"ver_proveedores",views:{report_content:{templateUrl:"==informes/verProveedores.tpl.html",controller:"VerProveedoresCtrl",resolve:{proveedores:["$http","$stateParams",function(a,b){return a.get("::proveedores/all")}]}}},data:{pageTitle:"Proveedores - Feryz"}})}])}.call(this),function(){"use strict";angular.module("feryzApp").controller("InformesCtrl",["$scope","$http","$state","$cookieStore","$rootScope","toastr","$filter",function(a,b,c,d,e,f,g){return a.config={},a.verProductos=function(){return c.go("panel.informes.ver_productos",{},{reload:!0})},a.verProveedores=function(){return c.go("panel.informes.ver_proveedores",{},{reload:!0})},a.verUsuarios=function(){return c.go("panel.informes.ver_usuarios",{},{reload:!0})},a.$on("cambia_descripcion",function(b,c){return a.descripcion_informe=c}),d.get("config")?(a.config=d.get("config"),a.informe_tab_productos="productos"===a.config.informe_tab_actual?!0:!1):a.config.orientacion="vertical",a.$watch("config",function(b,c){return d.put("config",b),a.$broadcast("change_config")},!0),a.tabSeleccionado=function(b){return a.config.informe_tab_actual=b,d.put("config",a.config)}}])}.call(this),function(){"use strict";angular.module("feryzApp").controller("VerUsuariosCtrl",["$scope","$http","$state","$cookies","$rootScope","toastr","$filter","usuarios",function(a,b,c,d,e,f,g,h){return a.usuarios=h.data}])}.call(this),function(){"use strict";angular.module("feryzApp").controller("VerProductosCtrl",["$scope","$http","$state","$cookies","$rootScope","toastr","$filter","productos",function(a,b,c,d,e,f,g,h){return a.productos=h.data}])}.call(this),function(){"use strict";angular.module("feryzApp").controller("VerProveedoresCtrl",["$scope","$http","$state","$cookies","$rootScope","toastr","$filter","proveedores",function(a,b,c,d,e,f,g,h){return a.proveedores=h.data,console.log(a.proveedores)}])}.call(this),function(){angular.module("feryzApp").config(["$stateProvider","App",function(a,b){return a.state("panel.ciudades",{url:"^/ciudades",views:{contenido_panel:{templateUrl:"==ciudades/ciudades.tpl.html",controller:"CiudadesCtrl"}}})}])}.call(this),function(){angular.module("feryzApp").controller("CiudadesCtrl",["$scope","$http","App","$filter","toastr",function(a,b,c,d,e){return a.creandociudad=!1,a.creandodepartamento=!1,a.creandopais=!1,a.crearciudad={nuevo_depart:!1},a.modificando_depart=!1,a.crearpais={},a.hola=!1,b.get("::paises/all").then(function(b){return a.paises=b.data,a.crearciudad.pais=d("filter")(a.paises,{id:1})[0],a.paisSeleccionado(a.crearciudad.pais)},function(){return e.error("No se pudo traer las ciudades.")}),a.paisSeleccionado=function(c,f){return b.get("::ciudades/departamentos",{params:{pais_id:c.id}}).then(function(b){return a.departamentos=b.data,a.modificando_depart?(a.crearciudad.depart=d("filter")(a.departamentos,{departamento:f},!0)[0],a.departamentoSeleccionado(a.crearciudad.depart),a.modificando_depart=!1):void 0},function(){return e.error("No se pudo traer las ciudades.")})},a.departamentoSeleccionado=function(c,d){return b.get("::ciudades/ciudades",{params:{departamento:c.departamento}}).then(function(b){return a.ciudades=b.data},function(){return e.error("No se pudo traer las ciudades.")})},a.crearCiudad=function(){return a.creandociudad=!0},a.crearDepartamento=function(){return a.creandodepartamento=!0},a.crearPais=function(){return a.creandopais=!0},a.guardarCiudad=function(){return b.post("::ciudades/guardarciudad",a.crearciudad).then(function(c){return e.success("Creado correctamente: "+c.data.ciudad),a.ciudades.push(c.data),a.creandociudad=!1,a.crearciudad={},a.guardar=!0,b.get("::paises/all").then(function(a){},a.paises=c.data,a.crearciudad.pais=d("filter")(a.paises,{id:1})[0],a.paisSeleccionado(a.crearciudad.pais),function(a){return e.error("No se pudo traer las ciudades.")})},function(a){return e.error("No se pudo crear","Error")})},a.guardarPais=function(){return b.post("::paises/guardar",a.crearpais).then(function(b){return e.success("Creado correctamente: "+b.data.paisnuevo),a.paises.push(b.data),a.paisSeleccionado(a.crearciudad.pais)},function(a){return e.error("No se pudo crear","Error")})},a.actualizarCiudad=function(a){return b.put("::ciudades/actualizar-ciudad",a).then(function(b){return e.success("Actualizado: "+a.ciudad),a.editandoCiudad=!1},function(a){return e.error("No se pudo actualizar","Error")})},a.actualizarDepartamento=function(c){return b.put("::ciudades/actualizar-departamento",c).then(function(b){var d;return e.success("Actualizado: "+c.departamento),c.editandoDepart=!1,d=a.crearciudad.pais,a.modificando_depart=!0,a.paisSeleccionado(d,c.departamento)},function(a){return e.error("No se pudo actualizar","Error")})},a.actualizarPais=function(a){return b.put("::paises/actualizar",a).then(function(b){return e.success("Actualizado: "+a.pais),a.editandoPais=!1,a.editandoAbrev=!1},function(a){return e.error("No se pudo actualizar","Error")})},a.eliminarUsuario=function(c){return b["delete"]("::usuarios/eliminar/"+c.id).then(function(b){return a.usuarios=d("filter")(a.usuarios,{id:"!"+c.id})},function(a){return console.log("No se pudo eliminar producto",a)})},a.editarUsuario=function(c){var e;return a.editando=!0,a.usuarioActualizar=c,e=d("filter")(a.tipos_doc,{tipo:a.usuarioActualizar.doc_tipo},!0),e=e.length>0?e[0]:a.tipos_doc[0],a.usuarioActualizar.doc_tipo=e,null===a.usuarioActualizar.ciudad_nac?(a.usuarioActualizar.pais={id:1,pais:"COLOMBIA",abrev:"CO"},a.paisSeleccionado(a.usuarioActualizar.pais,a.usuarioActualizar.pais)):b.get("::ciudades/datosciudad/"+a.usuarioActualizar.ciudad_nac).then(function(b){return a.paises=b.data.paises,a.departamentosNac=b.departamentos,a.ciudadesNac=b.ciudades,a.usuarioActualizar.pais=b.pais,a.usuarioActualizar.depart_nac=b.departamento,a.usuarioActualizar.ciudad_nac=b.ciudad})}}])}.call(this),function(){angular.module("feryzApp").config(["$stateProvider","App",function(a,b){return a.state("panel.configuraciones",{url:"^/configuraciones",views:{contenido_panel:{templateUrl:"==configuraciones/configuraciones.tpl.html",controller:"ConfiguracionesCtrl"}}})}])}.call(this),function(){angular.module("feryzApp").controller("ConfiguracionesCtrl",["$scope","$http","App","$filter","toastr",function(a,b,c,d,e){return a.configuracion={},a.guardar=function(c){return b.put("::configuracion/actualizar",a.configuracion).then(function(b){return e.success(a.configuracion.nombre_ips+' "Actualizada correctamente"')},function(a){return e.error("No se pudo Actualizar","Error"),console.log("No se pudo actualizar configuracion",a)})},a.traerConfiguracion=function(){return b.get("::configuracion/all").then(function(b){return a.configuracion=b.data[0]},function(a){return console.log("No se pudo traer la configuracion",a)})},a.traerConfiguracion()}])}.call(this),function(){"use strict";angular.module("feryzApp").config(["$stateProvider",function(a){return a.state("panel.filemanager",{url:"/filemanager",views:{contenido_panel:{templateUrl:"==fileManager/fileManager.tpl.html",controller:"FileManagerCtrl"}},data:{pageTitle:"Administrador de archivos"}})}])}.call(this),function(){"use strict";angular.module("feryzApp").controller("FileManagerCtrl",["$scope","Upload","$timeout","$filter","App","$http","Perfil","$uibModal","resolved_user","toastr","AuthService",function(a,b,c,d,e,f,g,h,i,j,k){var l,m,n;a.USER=i,a.subir_intacta={},a.hasRoleOrPerm=k.hasRoleOrPerm,l=function(){return a.dato={imgUsuario:{id:a.USER.imagen_id,nombre:a.USER.image_nombre}}},l(),a.perfilPath=e.images+"perfil/",a.imgFiles=[],a.errorMsg="",a.fileReaderSupported=null!==window.FileReader&&(null===window.FileAPI||FileAPI.html5!==!1),a.dato.usuarioElegido=[],f.get("::imagenes/con-usuarios").then(function(b){return b=b.data,a.imagenes=b.imagenes,a.usuarios=b.usuarios,a.dato.usuarioElegido=b[0],a.dato.imgParaUsuario=b.imagenes[0]},function(a){return j.error("No se trajeron las imágenes y usuarios.")}),a.upload=function(b){var c,d,e,f,g;if(a.imgFiles=b,a.errorMsg="",b&&b.length){for(g=[],d=e=0,f=b.length;f>=0?f>e:e>f;d=f>=0?++e:--e)c=b[d],g.push(m(c));return g}},m=function(b){return a.errorMsg=null,n(b),a.generateThumb(b)},a.generateThumb=function(b){return null!==b&&a.fileReaderSupported&&b.type.indexOf("image")>-1?c(function(){var a;return a=new FileReader,a.readAsDataURL(b),a.onload=function(a){return c(function(){return b.dataUrl=a.target.result})}}):void 0},n=function(c){var d;return d=a.subir_intacta.intacta?"-intacta":"",c.size>1e7?void(a.errorMsg="Archivo excede los 10MB permitidos."):b.upload({url:e.Server+"imagenes/store"+d,file:c}).progress(function(a){var b;return b=parseInt(100*a.loaded/a.total),c.porcentaje=b}).success(function(b,c,d,e){return a.imagenes.push(b)}).error(function(a){return console.log("Falla uploading: ",a)}).xhr(function(a){})},a.pedirCambioUsuario=function(b){return f.put("::imagenes/cambiar-imagen-perfil/"+a.USER.id,{image_id:b.id}).then(function(c){return c=c.data,g.setImagen(c.imagen_id,b.nombre),a.$emit("cambianImgs",{image:c}),j.success("Imagen principal cambiada")},function(a){return j.error("No se pudo cambiar imagen","Problema")})},a.cambiarLogo=function(a){return f.put("::imagenes/cambiar-logo",{logo_id:a.id}).then(function(a){return j.success("Logo de la empresa cambiado")},function(a){return j.error("No se pudo cambiar el logo","Problema")})},a.fotoSelect=function(a,b){},a.rotarImagen=function(a){return f.put("::imagenes/rotarimagen/"+a.id).then(function(b){return a.nombre="",j.success("Imagen rotada"),a.nombre=b+"?"+(new Date).getTime()},function(a){return j.error("Imagen no rotada")})},a.borrarImagen=function(b){var c;return c=h.open({templateUrl:"==fileManager/removeImage.tpl.html",controller:"RemoveImageCtrl",size:"sm",resolve:{imagen:function(){return b}}}),c.result.then(function(b){return a.imagenes=d("filter")(a.imagenes,{id:"!"+b.id})})},a.usuarioSelect=function(b,c){return a.dato.selectUsuarioModel=b},a.cambiarFotoUnUsuario=function(a,b){var c;return c={imgUsuario:b.id},f.put("::perfiles/cambiar-img-usuario/"+a.id,c).then(function(a){return j.success("Foto oficial asignada con éxito")},function(a){return j.error("Error al asignar foto al usuario","Problema")})},a.pedirCambioFirma=function(a,b){var c;return c={imgFirma:b.id},f.put("::perfiles/cambiar-firma/"+a.id,c).then(function(a){return j.success("Firma asignada con éxito")},function(a){return j.error("Error al asignar firma","Problema")})}}])}.call(this),function(){angular.module("feryzApp").controller("RemoveImageCtrl",["$scope","$uibModalInstance","imagen","App","$http","AuthService","toastr",function(a,b,c,d,e,f,g){a.imagesPath=d.images+"perfil/",a.imagen=c,a.hasRoleOrPerm=f.hasRoleOrPerm,a.ok=function(){return e["delete"]("::imagenes/destroy/"+c.id).then(function(a){return g.success("La imagen ha sido removida.")},function(a){return g.error("No se pudo eliminar la imagen.")}),b.close(c)},a.cancel=function(){return b.dismiss("cancel")}}])}.call(this),function(){angular.module("feryzApp").factory("AuthService",["App","$state","$http","$cookies","Perfil","$rootScope","AUTH_EVENTS","$q","$filter","toastr",function(a,b,c,d,e,f,g,h,i,j){var k;return k={},k.verificando=!1,k.promesa_de_verificacion={},k.verificar=function(){var a;return k.verificando?k.promesa_de_verificacion:(a=h.defer(),e.User().id?a.resolve(e.User()):d.get("xtoken")?void 0!==d.get("xtoken")&&"undefined"!==d.get("xtoken")&&"[object Object]"!==d.get("xtoken")?k.login_from_token().then(function(b){return e.setUser(b),a.resolve(b)},function(b){return console.log("No se logueó from token"),a.reject(b)}):(console.log("Token mal estructurado: ",d.get("xtoken")),k.borrarToken(),f.$broadcast(g.notAuthenticated),a.reject("Token mal estructurado.")):(console.log("No hay cookie token."),a.reject("No hay cookie token."),b.go("login"),f.$broadcast(g.notAuthenticated)),k.promesa_de_verificacion=a.promise,k.promesa_de_verificacion)},k.verificar_acceso=function(){var a,c;return e.User().id||b.go("login"),c=b.current,c.data.needed_roles?(a=c.data.needed_roles,k.isAuthorized(a)?void 0:(console.log("No tiene permisos, y... "),f.lastState=c.name,k.isAuthenticated()?(f.$broadcast(g.notAuthorized),console.log("...está Autenticado.")):(console.log("...NO está Autenticado."),b.transitionTo("login")))):!0},k.login_credentials=function(a){var i;return i=h.defer(),k.borrarToken(),c.post("::login/login",a).then(function(a){return a.data.token?(d.put("xtoken",a.data.token),c.defaults.headers.common.Authorization="Bearer "+d.get("xtoken"),e.setUser(a.data),f.$broadcast(g.loginSuccess),i.resolve(a.data)):(f.$broadcast(g.loginFailed),i.reject("Error en login"))},function(a){return f.$broadcast(g.loginFailed),a?a.status?400===a.status?j.error("Datos inválidos","",{timeOut:8e3}):-1===a.status?j.error("No parece haber comunicación con el servidor","",{timeOut:8e3}):500===a.status&&j.error("No parece haber comunicación con la Base de datos","",{timeOut:8e3}):a.data?a.data.error&&("Token expirado"===a.data.error||"token_expired"===a.error?(j.warning("La sesión ha expirado"),"login"!==b.current.name&&b.go("login")):f.$broadcast(g.loginFailed)):j.error("No parece haber comunicación con el servidor"):j.error("No parece haber comunicación con el servidor"),i.reject("Error en login")}),i.promise},k.login_from_token=function(){var a,b;return a=h.defer(),e.User().id||void 0===e.User().id?(c.defaults.headers.common.Authorization="Bearer "+d.get("xtoken"),b=c.post("::login/verificar").then(function(b){return f.$broadcast(g.loginSuccess),a.resolve(b.data)},function(b){return console.log("No se pudo loguear con token. ",b),a.reject("Error en login con token."),f.$broadcast(g.loginFailed)})):a.resolve(e.User()),a.promise},k.logout=function(a){return f.lastState=null,f.lastStateParam=null,k.borrarToken(),e.deleteUser(),b.transitionTo("login")},k.borrarToken=function(){return d.remove("xtoken"),delete c.defaults.headers.common.Authorization},k.isAuthenticated=function(){return!!e.User().id},k.isAuthorized=function(a){var b,c;return c=e.User(),c.is_superuser?!0:(angular.isArray(a)||(a=[a]),c.tipo_usu_id&&0===a.length?!0:(b=[],_.each(a,function(a){return c.tipo_usu_id===a?b.push(a):void 0}),k.isAuthenticated()&&b.length>0))},k.hasRoleOrPerm=function(a){return a===e.User().tipo_usu_id?!0:2===a&&7===e.User().tipo_usu_id?!0:e.User().is_superuser?!0:!1},k}])}.call(this),function(){angular.module("feryzApp").factory("Perfil",["App","AUTH_EVENTS","$http",function(a,b,c){var d;return d={},{setUser:function(a){return d=a},User:function(){return d},id:function(){return d.user_id},idioma:function(){return d.idioma_main_id},setImagen:function(a,b){return d.imagen_id=a,d.image_nombre=b},deleteUser:function(){return d={}}}}])}.call(this),function(){angular.module("feryzApp").directive("updateTitle",["$rootScope","$timeout",function(a,b){return{link:function(c,d){var e;return e=function(a,c,e){var f;return f="MyVc",c.data&&c.data.pageTitle&&(f=c.data.pageTitle),e&&e.username&&(f=e.username+" - MyVc"),b(function(){return d.text(f)},0,!1)},a.$on("$stateChangeSuccess",e)}}}])}.call(this),function(){angular.module("feryzApp").filter("porIdioma",[function(){return function(a,b){var c,d,e,f,g;if(a){for(g=[],b=parseFloat(b),d=0,f=a.length;f>d;d++)c=a[d],e=parseFloat(c.idioma_id),b===e&&g.push(c);return g}return!1}}])}.call(this);